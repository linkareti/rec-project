<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

	<changeSet author="sbogas"
		id="2017-06-05-modify-column_location_size-naturality">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="naturality" columnName="location" />
		</preConditions>
		<modifyDataType tableName="naturality" columnName="location"
			newDataType="varchar(150)" />
	</changeSet>

	<changeSet author="pzenida" id="2017-05-31-update-message-template">
		<sql>
			<![CDATA[
update message_template set subject = 'Nascimento online - confirmação de registo de nascimento',
content = 
'<p>Olá.</p>
<p>Antes de mais, gostaríamos de dar-lhe os parabéns pelo nascimento do seu bebé: ${birthRegistration.name}!</p>
<p>Para concluir o pedido de registo de nascimento online que foi registado pelo 1.º progenitor, ${birthRegistration.firstParent.name}, clique por favor no endereço apresentado 
abaixo, começando a validação do pedido pela sua identificação com o cartão de cidadão e, após verificar a veracidade dos dados registados, no separador "Resumo", 
deverá escolher a opção Aceitar.</p>
<p><a href="${applicationBaseUrl}/index.xhtml?uuid=${birthRegistration.uuid}">VALIDAR PEDIDO</a></p>' where code = 'EMAIL_001'
			]]>
		</sql>
		<rollback />
	</changeSet>

	<changeSet author="pzenida"
		id="2017-05-31-insert-recover-password-message-template">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
                                <![CDATA[
select count(*) from message_template where code = 'EMAIL_002'
                                ]]>
			</sqlCheck>
		</preConditions>
		<sql>
			<![CDATA[
insert into message_template (id, creation_date, code, type, subject, content)
VALUES (2, CURRENT_TIMESTAMP(), 'EMAIL_002', 'EMAIL', 'Recuperação de palavra-passe',
'<p>Foi criado um pedido de recuperação de palavra-passe para esta conta. Se não foi você que o efetuou, por favor ignore esta mensagem!</p>
<p>Caso contrário, por favor, carregue no link apresentado abaixo para continuar o processo de recuperação de palavra-passe:</p>
<p><a href="${applicationBaseUrl}/reset_password.xhtml?username=$username&token=$token">RECUPERAR PALAVRA PASSE</a></p>')
			]]>
		</sql>
		<rollback>
			<sql>
				<![CDATA[
delete from message_template where code = 'EMAIL_002'
                ]]>
			</sql>
		</rollback>
	</changeSet>
</databaseChangeLog>