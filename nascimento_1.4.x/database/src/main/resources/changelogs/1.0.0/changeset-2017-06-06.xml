<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

	<changeSet author="pzenida"
		id="2017-06-06-add-recover-password-timeout-millis-configuration">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="configuration"
					columnName="recover_password_timeout_millis" />
			</not>
		</preConditions>
		<addColumn tableName="configuration">
			<column name="recover_password_timeout_millis" type="bigint(20)"
				defaultValue="600000" /> <!-- default is 10 minutes -->
		</addColumn>
	</changeSet>

	<changeSet author="pzenida"
		id="2017-06-06-add-captcha-public-key-configuration">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="configuration" columnName="captcha_public_key" />
			</not>
		</preConditions>
		<addColumn tableName="configuration">
			<column name="captcha_public_key" type="varchar(75)"
				defaultValue="6LcHMCQUAAAAADyJH1PAIecgjU-lrjtsFVpmDv-g" />
		</addColumn>
	</changeSet>

	<changeSet author="pzenida"
		id="2017-06-06-add-captcha-private-key-configuration">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="configuration" columnName="captcha_private_key" />
			</not>
		</preConditions>
		<addColumn tableName="configuration">
			<column name="captcha_private_key" type="varchar(75)"
				defaultValue="6LcHMCQUAAAAAHuh4ahsfu50ENFR5U7s0M1SW2CD" />
		</addColumn>
	</changeSet>

	<changeSet author="pzenida"
		id="2017-06-06-add-combined-resource-handler-disabled-configuration">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="configuration"
					columnName="combined_resource_handler_disabled" />
			</not>
		</preConditions>
		<addColumn tableName="configuration">
			<column name="combined_resource_handler_disabled" type="tinyint(1)"
				defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet author="pzenida"
		id="2017-06-06-fixing-saml_identity_provider_certificate_validation-column">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="configuration"
				columnName="saml_identity_provider_certificate_validation" />
		</preConditions>
		<update tableName="configuration">
			<column name="saml_identity_provider_certificate_validation"
				value="null" />
		</update>
		<renameColumn tableName="configuration"
			oldColumnName="saml_identity_provider_certificate_validation"
			newColumnName="saml_identity_provider_certificate_validation"
			columnDataType="tinyint(1)" />
		<update tableName="configuration">
			<column name="saml_identity_provider_certificate_validation"
				value="0" />
		</update>
		<rollback>
			<update tableName="configuration">
				<column name="saml_identity_provider_certificate_validation"
					value="null" />
			</update>
			<renameColumn tableName="configuration"
				oldColumnName="saml_identity_provider_certificate_validation"
				newColumnName="saml_identity_provider_certificate_validation"
				columnDataType="varchar(75)" />
			<update tableName="configuration">
				<column name="saml_identity_provider_certificate_validation"
					value="false" />
			</update>
		</rollback>
	</changeSet>

</databaseChangeLog>