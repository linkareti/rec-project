<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                    <title>Creating a New Experiment Driver (Product_ReC.Creating a New Experiment Driver) - XWiki</title>
                <meta http-equiv="Content-Script-Type" content="text/javascript" />
                        <meta http-equiv="imagetoolbar" content="no"/>
                                <link rel="canonical" href="xwikidev.Product_ReC.Creating a New Experiment Driver.html" />
                            <meta name="document" content="Product_ReC.Creating a New Experiment Driver"/>
    <meta name="wiki" content="xwikidev"/>
    <meta name="space" content="Product_ReC"/>
    <meta name="page" content="Creating a New Experiment Driver"/>
    <meta name="version" content="33.1"/>
    <meta name="restURL" content="/rest/wikis/xwikidev/spaces/Product_ReC/pages/Creating+a+New+Experiment+Driver"/>
                <meta name="gwt:property" content="locale=en" />
                <meta name="revisit-after" content="7 days" />
<meta name="description" content="Creating a New Experiment Driver" />
<meta name="keywords" content="wiki" />
<meta name="distribution" content="GLOBAL" />
<meta name="rating" content="General" />
<meta name="author" content="bcatarino" />
<meta http-equiv="reply-to" content="" />
<meta name="language" content="en" />
<link rel="alternate" type="application/rss+xml" title="Wiki Feed RSS" href="https://xwiki-dev.linkare.com/bin/view/Main/WebRss?xpage=rdf" />
<link rel="alternate" type="application/rss+xml" title="Blog RSS Feed" href="https://xwiki-dev.linkare.com/bin/view/Blog/GlobalBlogRss?xpage=plain" />
<script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

                <!-- com.xpn.xwiki.plugin.skinx.LinkExtensionPlugin -->
    <link href="https://xwiki-dev.linkare.com/bin/skin/Code/LinkareSkin/style.css" rel="stylesheet" type="text/css" media="all" />
<link href="skins/colibri/print.css" rel="stylesheet" type="text/css" media="print" />
        <!--[if IE]>
  <link href="skins/colibri/ie-all.css" rel="stylesheet" type="text/css" />
<![endif]-->
<!--[if IE 6]>
  <link href="skins/colibri/ie-6.css" rel="stylesheet" type="text/css" />
<![endif]-->
<!-- com.xpn.xwiki.plugin.skinx.CssSkinExtensionPlugin -->
<!-- com.xpn.xwiki.plugin.skinx.CssSkinFileExtensionPlugin -->

    
    <link href="resources/js/xwiki/suggest/ajaxSuggest.css" rel="stylesheet" type="text/css" />
<link href="resources/js/xwiki/lightbox/lightbox.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
  <link href="resources/js/xwiki/lightbox/lightboxIE.css" rel="stylesheet" type="text/css" />
<![endif]-->
<script type="text/javascript" src="resources/js/prototype/prototype.js"></script>
<script type="text/javascript" src="resources/js/xwiki/xwiki.js"></script>
<script type="text/javascript" src="resources/js/xwiki/suggest/ajaxSuggest.js"></script>
<script type="text/javascript">
// <![CDATA[
XWiki.webapppath = "";
XWiki.servletpath = "bin/";
XWiki.contextPath = "";
XWiki.mainWiki = "xwiki";
XWiki.currentWiki = "xwikidev";
XWiki.currentSpace = "Product_ReC";
XWiki.currentPage = "Creating a New Experiment Driver";
XWiki.editor = "";
XWiki.viewer = "";
XWiki.contextaction = "export";
XWiki.docisnew = false;
XWiki.docsyntax = "xwiki/2.0";
XWiki.blacklistedSpaces = [  ];
XWiki.hasEdit = true;
XWiki.hasProgramming = true;
window.docviewurl = "xwikidev.Product_ReC.Creating a New Experiment Driver.html";
window.docediturl = "https://xwiki-dev.linkare.com/bin/edit/Product_ReC/Creating+a+New+Experiment+Driver";
window.docsaveurl = "https://xwiki-dev.linkare.com/bin/save/Product_ReC/Creating+a+New+Experiment+Driver";
window.docgeturl = "https://xwiki-dev.linkare.com/bin/get/Product_ReC/Creating+a+New+Experiment+Driver";
// ]]>
</script>
<!-- com.xpn.xwiki.plugin.skinx.JsSkinFileExtensionPlugin -->
<!-- com.xpn.xwiki.plugin.skinx.JsSkinExtensionPlugin -->
<script type="text/javascript" src="resources/js/xwiki/compatibility.js" defer="defer"></script>

  </head>
        <body id="body" class="wiki-xwikidev viewbody ">

    <div id="mainContentArea">
    
<div id="document-title"><h1>Creating a New Experiment Driver</h1></div>

<div id="xwikicontent">
<h1 id="HGoal"><span>Goal</span></h1><p>This document complements the document <span class="wikilink"><a href="https://xwiki-dev.linkare.com/bin/view/Product_ReC/HowToCreateExperimentGUI">Creating a New Experiment GUI</a></span> by providing generic information about experiment drivers and aims to be a step by step tutorial of how to create a new experiment driver to comunicate with an hardware device or that generates virtual data.</p><h1 id="HIntendedAudience"><span>Intended Audience</span></h1><p>This document is targeted at software developers that need to create drivers for new experiments for eLab.</p><h1 id="HExpectedBackgroundKnowledge"><span>Expected Background Knowledge</span></h1><ul><li>Solid Java Programming Language.</li><li>Knowledge of how to integrate java with hardware (hardware communication API's like jsr88-usb and JavaComm or RXTX, Sound API, JMF API).</li><li>Data Acquisition Systems basic knowledge&nbsp;</li><li>Some knowledge of the Scientific Methods in the field of Physics, Chemistry, Biology, Mathematics (and so forth, depending on the experiment), is quite valuable.</li></ul><h1 id="HGeneralStructureofaDriver"><span>General Structure of a Driver</span></h1><p>A driver can be as simple or as complex as the experiment it represents. At his most simplicity, the following files are required to build an experiment driver:</p><ul><li>A class that implements <span class="box code">com.linkare.rec.impl.driver.IDriver</span>. This class is responsible to control the hardware and notify of hardware state changes.</li><li>A class that implements <span class="box code">com.linkare.rec.impl.data.SamplesSource</span>. This class is responsible to receive the data from the hardware or generate virtual data.</li><li>An HardwareInfo.xml, which specifies information about the experiment and driver inputs and outputs.</li><li>A <span class="box code">ServerMain</span> class can also be specified (not mandatory) to run tests over the Driver.</li></ul><p>Still, the driver's programmer is free to create any additional classes and interfaces to better separate concerns, take advantage of Object Oriented capabilities, etc. The driver's programmer is free to create any packaging he wishes inside the source directory for the experiment, but he should not create any experiment specific classes outside of the source folder of that particular experiment.</p><h1 id="HCreatinganewExperiment28TheRollpaperExperiment29"><span>Creating a new Experiment (The Rollpaper Experiment)</span></h1><h2 id="HStep1-CreatetheStructureforaNewExperiment"><span>Step 1 - Create the Structure for a New Experiment</span></h2><p>There is one single directory where eLab keeps all its experiments. This directory (<strong><em>experiments</em></strong>) exists at ReC's root directory.</p><p>The base structure should be created after you use the target:</p><div class="box"><p>ant -f build_new_experiment.xml create.experiment -Dexperiment.name=rollpaper</p></div><p>After executing this command, the <em><strong>experiments/rollpaper/src/java/server</strong></em> directory was created.</p><p>Let's now create two packages with the following files inside each of them:</p><ul><li><strong>pt.utl.ist.elab.driver.rollpaper:&nbsp;</strong>experiment classes plus HardwareInfo.xml, when required<ul><li><em>RollPaperDriver.java:</em> Represents the hardware driver.</li><li>RollPaperDataProducer.java: Represents the producer of the data.</li><li><em>RollPaperSampleGenerator.java:</em> Generates simulated data (since this sample experiment is a virtual experiment). It's not required by ReC. It's just a helper class.</li><li><em>ServerMain.java:</em> main class from which the hardware server for this experiment will be launched.</li><li><em>HardwareInfo.xml:</em> contains the hardware configuration. It may not be necessary, depending of the implementation of the driver's getHardwareInfo() implementation.</li></ul></li><li><strong>pt.utl.ist.elab.driver.rollpaper.resources:</strong> experiment resources for the driver<ul><li><em>RollPaperBytesArray.txt:</em>Used to temporarily store the byte array information of the image.</li><li><em>test.gif</em>:<em>&nbsp;</em>Used in this experiment to simulate byteArray PhysicsVal types.</li></ul></li></ul><p>You are free to organize your packaging any way you want, but try to follow these standards. You may create subpackages freely, if you will.</p><p>The files in the <strong>pt.utl.ist.elab.driver.rollpaper</strong> package will be explained in more detail in the following sections.</p><h2 id="HStep2-CreatetheDriverClass"><span>Step 2 - Create the Driver Class</span></h2><h3 id="HChoosingtherightparentclass2Finterface"><span>Choosing the right parent class/interface</span></h3><p>The driver class, which is responsible to control the hardware, must directly or indirectly implement <span class="box code">com.linkare.rec.impl.driver.IDriver</span>. The ReC framework provides an abstract class that already guarantee some common behaviour to all drivers that extend it. That's the <span class="box code">com.linkare.rec.impl.driver.BaseDriver</span> class.</p><p>Elab also provides a set of abstract driver types. The most important is the <span class="box code">pt.utl.ist.elab.driver.serial.serialportgeneric.AbstractSerialPortDriver.GenericSerialPortDriver</span>. The diagram below shows how these driver classes and interfaces relate to each other.</p><p><img src="http://www.plantuml.com/plantuml/img/2qfrrlDqASeiIorIiAdHqrC80Weu9HQdGiIuKBb09Rgw2ga-YKbwZad59KM9oIN1gKMPYJa1-KKbK1ruPP4CS4_D0qecO-WdR6D9Ocu18SLXcKKbfOav23a0" style="max-width:100%" alt="http://www.plantuml.com/plantuml/img/2qfrrlDqASeiIorIiAdHqrC80Weu9HQdGiIuKBb09Rgw2ga-YKbwZad59KM9oIN1gKMPYJa1-KKbK1ruPP4CS4_D0qecO-WdR6D9Ocu18SLXcKKbfOav23a0"/></p><p>When implementing a new driver, always remember to check if an abstraction for that driver type already exists that could make your job easier.</p><p>In our example, we'll extend directly the <span class="box code">com.linkare.rec.impl.driver.BaseDriver</span> class from the ReC framework.</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> <span style="font-weight: bold; color: #008000; ">class</span> <span style="font-weight: bold; color: #0000FF; ">RollPaperDriver</span> <span style="font-weight: bold; color: #008000; ">extends</span> BaseDriver <span style="color: #666666; ">{</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">public</span> <span style="color: #0000FF; ">RollPaperDriver</span><span style="color: #666666; ">()</span> <span style="color: #666666; ">{</span><br/> &nbsp;<span style="color: #666666; ">}</span></div><p>Note the definition of a no-args constructor, so newInstance() can be called by the ReC framework.</p><h3 id="HImplementgetHardwareInfo2829"><span>Implement getHardwareInfo()</span></h3><p>This method is responsible to create an hardware configuration. A typical implementation for this method is:</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> Object <span style="color: #0000FF; ">getHardwareInfo</span><span style="color: #666666; ">()</span> <span style="color: #666666; ">{</span><br/><br/> <span style="font-weight: bold; color: #008000; ">final</span> String baseHardwareInfoFile <span style="color: #666666; ">=</span> <span style="color: #BA2121; ">"recresource://"</span> <span style="color: #666666; ">+</span> getClass<span style="color: #666666; ">().</span><span style="color: #7D9029; ">getPackage</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">getName</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">replaceAll</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"\\."</span><span style="color: #666666; ">,</span> <span style="color: #BA2121; ">"/"</span><span style="color: #666666; ">)</span> <span style="color: #666666; ">+</span> <span style="color: #BA2121; ">"/HardwareInfo.xml"</span><span style="color: #666666; ">;</span><br/>&nbsp;String prop <span style="color: #666666; ">=</span> Defaults<span style="color: #666666; ">.</span><span style="color: #7D9029; ">defaultIfEmpty</span><span style="color: #666666; ">(</span>System<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getProperty</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"HardwareInfo"</span><span style="color: #666666; ">),</span> baseHardwareInfoFile<span style="color: #666666; ">);</span><br/><br/> <span style="font-weight: bold; color: #008000; ">if</span> <span style="color: #666666; ">(</span>prop<span style="color: #666666; ">.</span><span style="color: #7D9029; ">indexOf</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"://"</span><span style="color: #666666; ">)</span> <span style="color: #666666; ">==</span> <span style="color: #666666; ">-</span><span style="color: #666666; ">1</span><span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prop <span style="color: #666666; ">=</span> <span style="color: #BA2121; ">"file:///"</span> <span style="color: #666666; ">+</span> System<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getProperty</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"user.dir"</span><span style="color: #666666; ">)</span> <span style="color: #666666; ">+</span> <span style="color: #BA2121; ">"/"</span> <span style="color: #666666; ">+</span> prop<span style="color: #666666; ">;</span><br/> <span style="color: #666666; ">}</span><br/><br/>&nbsp;java<span style="color: #666666; ">.</span><span style="color: #7D9029; ">net</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">URL</span> url <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">null</span><span style="color: #666666; ">;</span><br/> <span style="font-weight: bold; color: #008000; ">try</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url <span style="color: #666666; ">=</span> ReCProtocols<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getURL</span><span style="color: #666666; ">(</span>prop<span style="color: #666666; ">);</span><br/> <span style="color: #666666; ">}</span> <span style="font-weight: bold; color: #008000; ">catch</span> <span style="color: #666666; ">(</span><span style="font-weight: bold; color: #008000; ">final</span> java<span style="color: #666666; ">.</span><span style="color: #7D9029; ">net</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">MalformedURLException</span> e<span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoggerUtil<span style="color: #666666; ">.</span><span style="color: #7D9029; ">logThrowable</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"Unable to load resource: "</span> <span style="color: #666666; ">+</span> prop<span style="color: #666666; ">,</span> e<span style="color: #666666; ">,</span> Logger<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getLogger</span><span style="color: #666666; ">(</span>ROLLPAPER_DRIVER_LOGGER<span style="color: #666666; ">));</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">try</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">new</span> java<span style="color: #666666; ">.</span><span style="color: #7D9029; ">net</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">URL</span><span style="color: #666666; ">(</span>baseHardwareInfoFile<span style="color: #666666; ">);</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span> <span style="font-weight: bold; color: #008000; ">catch</span> <span style="color: #666666; ">(</span><span style="font-weight: bold; color: #008000; ">final</span> java<span style="color: #666666; ">.</span><span style="color: #7D9029; ">net</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">MalformedURLException</span> e2<span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoggerUtil<span style="color: #666666; ">.</span><span style="color: #7D9029; ">logThrowable</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"Unable to load resource: "</span> <span style="color: #666666; ">+</span> baseHardwareInfoFile<span style="color: #666666; ">,</span> e2<span style="color: #666666; ">,</span> Logger<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getLogger</span><span style="color: #666666; ">(</span>ROLLPAPER_DRIVER_LOGGER<span style="color: #666666; ">));</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/> <span style="color: #666666; ">}</span><br/><br/> <span style="font-weight: bold; color: #008000; ">return</span> url<span style="color: #666666; ">;</span><br/><span style="color: #666666; ">}</span></div><p>This implementation requires that a file named <ins><em>HardwareInfo.xml</em></ins> exists in the same directory as the driver class (this file will be explained in a section below).</p><p>Although the most common implementation is having this file and return an URL to that file, that's not the only implementation possible for this method. This approach is usually better because it centers the configuration of the hardware on a single file. Since it's xml, it's easy to understand by people without some knowledge of programming, if they understand a minimum of the document structure (which is easier to learn than a programming language). Even to a programmer, the information in xml is more structured and it's easier to avoid mistakes.</p><p>The getHardwareInfo() method can return:</p><ul><li>An instance of the <span class="box code">com.linkare.rec.data.metadata.HardwareInfo</span> class. This implementation doesn't need that an <ins>HardwareInfo.xml</ins> exists.</li><li>A <span class="box code">java.net.URL</span> to an <ins>HardwareInfo.xml</ins> file, which will be automatically converted into an instance of <span class="box code">com.linkare.rec.data.metadata.HardwareInfo</span>.</li><li>A string representing the URL to an <ins>HardwareInfo.xml</ins> file.</li><li>A <span class="box code">java.io.InputStream</span> to the <ins>HardwareInfo.xml</ins> file.</li></ul><h3 id="HImplementgetDriverUniqueID2829"><span>Implement getDriverUniqueID()</span></h3><p>It identifies the driver. The implementation is very simple:</p><div class="box code"><span style="font-weight: bold; color: #008000; ">private</span> <span style="font-weight: bold; color: #008000; ">static</span> <span style="font-weight: bold; color: #008000; ">final</span> String DRIVER_UNIQUE_ID <span style="color: #666666; ">=</span> <span style="color: #BA2121; ">"ROLLPAPER_V1.0"</span><span style="color: #666666; ">;</span><br/><br/><span style="font-weight: bold; color: #008000; ">public</span> String <span style="color: #0000FF; ">getDriverUniqueID</span><span style="color: #666666; ">()</span> <span style="color: #666666; ">{</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">return</span> DRIVER_UNIQUE_ID<span style="color: #666666; ">;</span><br/><span style="color: #666666; ">}</span></div><h3 id="HImplementinit28HardwareInfo29"><span>Implement init(HardwareInfo)</span></h3><p>Does any initialization code necessary. In our example, we only need to notify the driver listener that the driver has been initiated, using a method already available on the <span class="box code">com.linkare.rec.impl.driver.BaseDriver</span>.</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> <span style="color: #B00040; ">void</span> <span style="color: #0000FF; ">init</span><span style="color: #666666; ">(</span>HardwareInfo info<span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;fireIDriverStateListenerDriverInited<span style="color: #666666; ">();</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: italic; color: #408080; ">//Other initialization code that may be necessary<br/></span><span style="color: #666666; ">}</span></div><h3 id="HImplementextraValidateConfig28HardwareAcquisitionConfig2CHardwareInfo29"><span>Implement extraValidateConfig(HardwareAcquisitionConfig, HardwareInfo)</span></h3><p>Before the driver configuration process, the Hardware configuration is validated according to the current HardwareInfo (check if mandatory values are present, if values are within certain ranges of values, etc).</p><p>Still, there are some validations that may not be possible to map in the HardwareInfo. There may exist context validations. As an example, let's imagine there are two configuration parameters: param1 and param2. It is told in the HardwareInfo that param1 can have values between 1 and 3. But the experiment requires that param2 has values between 1 and 10 if param1 = 1, 11 to 43 if param1=2, and 4, 6, 12 to 15 and 42 if param1=3. This cannot be represented in HardwareInfo and requires more complex logic to check for these restrictions.</p><p>The extraValidateConfig is an extension point for the Driver to implement these complex rules that are not automatically validated by the framework.</p><p>In our cenario, no additional validation is necessary, so we'll leave the method empty.</p><h3 id="HImplementconfigure28HardwareAcquisitionConfig2CHardwareInfo29"><span>Implement configure(HardwareAcquisitionConfig, HardwareInfo)</span></h3><p>Prepares the driver to execute according to a given set of parameters. Sets all the parameters used as the hardware input and instantiates the data source that will collect the data from the hardware (or generate virtual samples if it's a virtual experiment). In the end, it notifies it's listener that it has reached the configured state.</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> <span style="color: #B00040; ">void</span> <span style="color: #0000FF; ">configure</span><span style="color: #666666; ">(</span>HardwareAcquisitionConfig config<span style="color: #666666; ">,</span> HardwareInfo info<span style="color: #666666; ">)</span> <span style="font-weight: bold; color: #008000; ">throws</span> WrongConfigurationException<span style="color: #666666; ">,</span> IncorrectStateException<span style="color: #666666; ">,</span> TimedOutException <span style="color: #666666; ">{</span><br/><br/> <span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">config</span> <span style="color: #666666; ">=</span> config<span style="color: #666666; ">;</span><br/> <span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">info</span> <span style="color: #666666; ">=</span> info<span style="color: #666666; ">;</span><br/><br/> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">int</span> tbs <span style="color: #666666; ">=</span> <span style="color: #666666; ">(</span><span style="color: #B00040; ">int</span><span style="color: #666666; ">)</span> config<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getSelectedFrequency</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">getFrequency</span><span style="color: #666666; ">();</span><br/> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">int</span> nSamples <span style="color: #666666; ">=</span> config<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getTotalSamples</span><span style="color: #666666; ">();</span><br/><br/> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">float</span> baseHeight1 <span style="color: #666666; ">=</span> Float<span style="color: #666666; ">.</span><span style="color: #7D9029; ">parseFloat</span><span style="color: #666666; ">(</span>config<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getSelectedHardwareParameterValue</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"baseHeight1"</span><span style="color: #666666; ">));</span><br/> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">float</span> baseHeight2 <span style="color: #666666; ">=</span> Float<span style="color: #666666; ">.</span><span style="color: #7D9029; ">parseFloat</span><span style="color: #666666; ">(</span>config<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getSelectedHardwareParameterValue</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"baseHeight2"</span><span style="color: #666666; ">));</span><br/> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">float</span> g <span style="color: #666666; ">=</span> Float<span style="color: #666666; ">.</span><span style="color: #7D9029; ">parseFloat</span><span style="color: #666666; ">(</span>config<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getSelectedHardwareParameterValue</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"g"</span><span style="color: #666666; ">));</span><br/> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">float</span> outerRadius <span style="color: #666666; ">=</span> Float<span style="color: #666666; ">.</span><span style="color: #7D9029; ">parseFloat</span><span style="color: #666666; ">(</span>config<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getSelectedHardwareParameterValue</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"outerRadius"</span><span style="color: #666666; ">));</span><br/> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">float</span> innerRadius <span style="color: #666666; ">=</span> Float<span style="color: #666666; ">.</span><span style="color: #7D9029; ">parseFloat</span><span style="color: #666666; ">(</span>config<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getSelectedHardwareParameterValue</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"innerRadius"</span><span style="color: #666666; ">));</span><br/><br/>&nbsp;dataSource <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">new</span> RollPaperDataProducer<span style="color: #666666; ">(</span><span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">,</span> baseHeight1<span style="color: #666666; ">,</span> baseHeight2<span style="color: #666666; ">,</span> g<span style="color: #666666; ">,</span> outerRadius<span style="color: #666666; ">,</span> innerRadius<span style="color: #666666; ">,</span> tbs<span style="color: #666666; ">,</span> nSamples<span style="color: #666666; ">);</span><br/><br/> <span style="font-weight: bold; color: #008000; ">for</span> <span style="color: #666666; ">(</span><span style="color: #B00040; ">int</span> i <span style="color: #666666; ">=</span> <span style="color: #666666; ">0</span><span style="color: #666666; ">;</span> i <span style="color: #666666; ">&lt;</span> config<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getChannelsConfig</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">length</span><span style="color: #666666; ">;</span> i<span style="color: #666666; ">++)</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;config<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getChannelsConfig</span><span style="color: #666666; ">(</span>i<span style="color: #666666; ">).</span><span style="color: #7D9029; ">setTotalSamples</span><span style="color: #666666; ">(</span>config<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getTotalSamples</span><span style="color: #666666; ">());</span><br/> <span style="color: #666666; ">}</span><br/><br/>&nbsp;dataSource<span style="color: #666666; ">.</span><span style="color: #7D9029; ">setAcquisitionHeader</span><span style="color: #666666; ">(</span>config<span style="color: #666666; ">);</span><br/><br/>&nbsp;fireIDriverStateListenerDriverConfigured<span style="color: #666666; ">();</span><br/><span style="color: #666666; ">}</span></div><p>Note that it's not necessary to notificate for the configuring state, because the base driver already does that step when configuring an experiment that extends from <span class="box code">com.linkare.rec.impl.driver.BaseDriver</span>.</p><h3 id="HImplementstart28HardwareInfo29"><span>Implement start(HardwareInfo)</span></h3><p>This method is called when the driver's client asks for the experiment to start.</p><p>Usually, the driver should inform its listener that the experiment has reached the starting state. In the meanwhile, it asks the data producer to start acquiring data. After this step, the driver has actually started, so it notifies its listener that it has reached the started state.</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> IDataSource <span style="color: #0000FF; ">start</span><span style="color: #666666; ">(</span>HardwareInfo info<span style="color: #666666; ">)</span> <span style="font-weight: bold; color: #008000; ">throws</span> IncorrectStateException <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;fireIDriverStateListenerDriverStarting<span style="color: #666666; ">();</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;dataSource<span style="color: #666666; ">.</span><span style="color: #7D9029; ">startProduction</span><span style="color: #666666; ">();</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;fireIDriverStateListenerDriverStarted<span style="color: #666666; ">();</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">return</span> dataSource<span style="color: #666666; ">;</span><br/><span style="color: #666666; ">}</span></div><p>The data source will be explained later.</p><h3 id="HImplementstartOutput28HardwareInfo2CIDataSource29"><span>Implement startOutput(HardwareInfo, IDataSource)</span></h3><p>It makes it possible to start the experiment, but using a data source other than the default for this driver. We won't be needing this (and most experiments don't need it also), so we'll just return null.</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> IDataSource <span style="color: #0000FF; ">startOutput</span><span style="color: #666666; ">(</span>HardwareInfo info<span style="color: #666666; ">,</span> IDataSource source<span style="color: #666666; ">)</span> <span style="font-weight: bold; color: #008000; ">throws</span> IncorrectStateException <span style="color: #666666; ">{</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">return</span> <span style="font-weight: bold; color: #008000; ">null</span><span style="color: #666666; ">;</span><br/><span style="color: #666666; ">}</span></div><h3 id="HImplementstop28HardwareInfo29"><span>Implement stop(HardwareInfo)</span></h3><p>Called when the driver's client decides to stop the experiment.</p><p>It usually uses a similar logic to the start method. It first notifies the listener that it has reached the stopping state, then it asks the data source to stop producing data, and finally it notifies the listener that it has reached the stopped state.</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> <span style="color: #B00040; ">void</span> <span style="color: #0000FF; ">stop</span><span style="color: #666666; ">(</span>HardwareInfo info<span style="color: #666666; ">)</span> <span style="font-weight: bold; color: #008000; ">throws</span> IncorrectStateException <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;fireIDriverStateListenerDriverStoping<span style="color: #666666; ">();</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;dataSource<span style="color: #666666; ">.</span><span style="color: #7D9029; ">stopNow</span><span style="color: #666666; ">();</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;fireIDriverStateListenerDriverStoped<span style="color: #666666; ">();</span><br/><span style="color: #666666; ">}</span></div><h3 id="HImplementreset28HardwareInfo29"><span>Implement reset(HardwareInfo)</span></h3><p>Used to reset the hardware. In the rollpaper example, no hardware reset is needed, so let's leave the method blank.</p><h3 id="HAddahookfordataproducercallbackswhenitstopsfeedingdata"><span>Add a hook for data producer callbacks when it stops feeding data</span></h3><p>It's not required by the ReC framework, but it's desirable that the driver is notified after the datasource stops producing data. This is only necessary for virtual experiments.code.</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> <span style="color: #B00040; ">void</span> <span style="color: #0000FF; ">stopVirtualHardware</span><span style="color: #666666; ">()</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;fireIDriverStateListenerDriverStoping<span style="color: #666666; ">();</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;fireIDriverStateListenerDriverStoped<span style="color: #666666; ">();</span><br/><span style="color: #666666; ">}</span></div><h2 id="HStep3-ConfiguringHardwareInfo"><span>Step 3 - Configuring HardwareInfo</span></h2><p>As mencioned earlier, the Hardware configuration can be represented as an xml file or as an object instanciated from HardwareInfo class. The most commons approach is using the xml file, since it's easier to read and maintain. We used this approach on our rollpaper example.</p><h3 id="HHeaderandDescription"><span>Header and Description</span></h3><div class="box code"><span style="color: #BC7A00; ">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br/><br/><span style="font-weight: bold; color: #008000; ">&lt;HardwareInfo</span> <span style="color: #7D9029; ">id=</span><span style="color: #BA2121; ">"ROLL_DOWN_TOILET_PAPER_V1.0"</span> <span style="color: #7D9029; ">familiarName=</span><span style="color: #BA2121; ">"Rollpaper"</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"Rollpaper"</span> <span style="color: #7D9029; ">version=</span><span style="color: #BA2121; ">"01"</span> <span style="color: #7D9029; ">manufacturer=</span><span style="color: #BA2121; ">"Elab - UTL"</span> <span style="color: #7D9029; ">driverVersion=</span><span style="color: #BA2121; ">"v1"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/><br/> <span style="font-weight: bold; color: #008000; ">&lt;description&gt;</span><br/><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #BC7A00; ">&lt;![CDATA[ <br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rollpaper.<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Drop two rolls of toilet paper of the same size. One is completely free to fall and the other hung by a tip.<br/>&nbsp;&nbsp;Of course, the free roll reaches the ground first because the acceleration of the first roll is less stuck. &nbsp;<br/>&nbsp;&nbsp;The goal of the experiment is to predict the initial heights that the rollers must have in order to reach <br/>&nbsp;&nbsp;the ground simultaneously. In the process, you have to use concepts of acceleration and momentum of inertia.<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]]&gt;</span><br/><br/> <span style="font-weight: bold; color: #008000; ">&lt;/description&gt;</span></div><p>The <strong>HardwareInfo</strong> is the root element of the HardwareInfo.xml document. It contains an experiment identifier and several informative attributes. You can also add a <strong>description</strong> for the experience. This description is not currently used by the eLab interface. It should also be a key to a resource bundle entry, to allow internationalization.</p><p>The <em>id</em> attribute must match exactly to the <em>location</em> attribute of the <strong>apparatus</strong> element in the ReCFaceConfig.xml for the experiment. The string is case-sensitive. If they are different in any way, the experiment will appear in the interface, but will not be available, since the framework won't be able to map the experiment in the client with an experiment registered in the multicast controller.</p><h3 id="HExperimentParameters"><span>Experiment Parameters</span></h3><p>An experiment parameter can be defined with the following xml block:</p><div class="box code"><span style="font-weight: bold; color: #008000; ">&lt;parameter</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"height1"</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"ContinuousValue"</span> <span style="color: #7D9029; ">value=</span><span style="color: #BA2121; ">"10.0"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;selection-list&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"1"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>10.0<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"2"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>100.0<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"3"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>1E-10<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;/selection-list&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/parameter&gt;</span></div><p>The attributes <em>name</em> and <em>value</em> are self explanatory.</p><p>The attribute type can have the following values:</p><ul><li>OnOffValue: acts like a boolean, with 0 and 1 as possible values.</li><li>ContinuousValue: any decimal value. The values are Scientific notation is allowed.</li><li>SelectionListValue: a fixed set of values.</li><li>BlackBoxValue: any type that doesn't fit in the first three types.</li></ul><p>The <strong>selection-list</strong> element child elements define the range of selection.</p><p>For a Continuous Value, the <em>order</em> of the <strong>value</strong> element represents:</p><ol><li>Minimum Value</li><li>Maximum Value</li><li>Step (the value that each unit increment adds to the previous value)</li></ol><p>For other types, the <em>order</em> represents the valid values for the parameter. Here are some examples of parameters for the other types, for reference (not part of the rollpaper experiment):</p><div class="box code"><span style="font-weight: bold; color: #008000; ">&lt;parameter</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"MovieOnOff"</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"OnOffValue"</span> <span style="color: #7D9029; ">value=</span><span style="color: #BA2121; ">"0"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;selection-list&gt;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"1"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>0<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"2"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>1<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;/selection-list&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/parameter&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;parameter</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"Material"</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"SelectionListValue"</span> <span style="color: #7D9029; ">value=</span><span style="color: #BA2121; ">"Chumbo (isolante)"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;selection-list&gt;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"1"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>Madeira [10mm]<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"2"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>Corticite [10mm]<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"3"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>Tijolo [10mm]<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"4"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>Cobre [0.2mm]<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"5"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>Cobre [0.4mm]<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"6"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>Cobre [0.8mm]<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"7"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>Cobre [1.6mm]<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"8"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>Cobre [3.2mm]<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"9"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>Janela de controlo (Ar)<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"10"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>Chumbo (isolante)<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">&lt;/selection-list&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/parameter&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;parameter</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"graph2"</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"BlackBoxValue"</span> <span style="color: #7D9029; ">value=</span><span style="color: #BA2121; ">"t.| r |"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/parameter&gt;</span></div><p>To complete the example, we have 4 more parameters defined in the rollpaper experiment, all of the same type:</p><div class="box code"><span style="font-weight: bold; color: #008000; ">&lt;parameter</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"height2"</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"ContinuousValue"</span> <span style="color: #7D9029; ">value=</span><span style="color: #BA2121; ">"10.0"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;selection-list&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"1"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>10.0<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"2"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>100.0<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"3"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>1E-10<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;/selection-list&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/parameter&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;parameter</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"g"</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"ContinuousValue"</span> <span style="color: #7D9029; ">value=</span><span style="color: #BA2121; ">"9.8"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;selection-list&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"1"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>0.2<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"2"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>12.0<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"3"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>5E-11<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;/selection-list&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/parameter&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;parameter</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"outerRadius"</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"ContinuousValue"</span> <span style="color: #7D9029; ">value=</span><span style="color: #BA2121; ">"10.0"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;selection-list&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"1"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>7.0<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"2"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>12.0<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"3"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>1E-10<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;/selection-list&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/parameter&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;parameter</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"innerRadius"</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"ContinuousValue"</span> <span style="color: #7D9029; ">value=</span><span style="color: #BA2121; ">"4.0"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;selection-list&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"1"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>0.5<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"2"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>7.0<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;value</span> <span style="color: #7D9029; ">order=</span><span style="color: #BA2121; ">"3"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>1E-10<span style="font-weight: bold; color: #008000; ">&lt;/value&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;/selection-list&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/parameter&gt;</span></div><h3 id="HFrequencyScale"><span>Frequency Scale</span></h3><p>The frequency by which the samples are collected. If necessary, the user may set the frequency in the interface.</p><p>This element can be defined as below</p><div class="box code"><span style="font-weight: bold; color: #008000; ">&lt;frequency-scale</span> <span style="color: #7D9029; ">label=</span><span style="color: #BA2121; ">"Sampling Interval"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;min-frequency&gt;&lt;Frequency</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"SamplingIntervalType"</span> <span style="color: #7D9029; ">multiplier=</span><span style="color: #BA2121; ">"none"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>10<span style="font-weight: bold; color: #008000; ">&lt;/Frequency&gt;&lt;/min-frequency&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;max-frequency&gt;&lt;Frequency</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"SamplingIntervalType"</span> <span style="color: #7D9029; ">multiplier=</span><span style="color: #BA2121; ">"none"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>50<span style="font-weight: bold; color: #008000; ">&lt;/Frequency&gt;&lt;/max-frequency&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;step-frequency&gt;&lt;Frequency</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"SamplingIntervalType"</span> <span style="color: #7D9029; ">multiplier=</span><span style="color: #BA2121; ">"none"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>1<span style="font-weight: bold; color: #008000; ">&lt;/Frequency&gt;&lt;/step-frequency&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/frequency-scale&gt;</span></div><p>The <strong>min-frequency</strong> and <strong>max-frequency</strong> define the internal in which the frequency may vary. The <strong>step-frequency</strong> defines the frequency variation between each value possible to select.</p><p>The <strong>Frequency</strong> <em>type</em> may have the following values:</p><ul><li>SamplingIntervalType: total number of samples.</li><li>FrequencyType: number of samples in a time unit, given in a multiple of Hz.</li></ul><p>The <em>multiplier</em> defines a potence of 10^(3*x) that will be multiplied by the value of the <strong>Frequency</strong> element. This avoids using very big numbers, by making all the calculations with small values in a certain unit and multiply the result by the multiplier's potence value. The <em>multiplier</em> can have the following values:</p><ul><li>fento (x = -5)</li><li>pico (x = -4)</li><li>nano (x = -3)</li><li>micro (x = -2)</li><li>milli (x = -1)</li><li>none (x = 0)</li><li>kilo (x = 1)</li><li>mega (x = 2)</li><li>giga (x = 3)</li><li>tera (x = 4)</li></ul><p>You can also define the default frequency for the experiment:</p><div class="box code"><span style="font-weight: bold; color: #008000; ">&lt;Frequency</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"SamplingIntervalType"</span> <span style="color: #7D9029; ">multiplier=</span><span style="color: #BA2121; ">"none"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>15<span style="font-weight: bold; color: #008000; ">&lt;/Frequency&gt;</span></div><h3 id="HSamplingScale"><span>Sampling Scale</span></h3><p>Defines the number of samples that will be obtained in an experiment's execution. The element names follow the same logic as in the frequency-scale.</p><div class="box code"><span style="font-weight: bold; color: #008000; ">&lt;sampling-scale&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;min-samples&gt;</span>10<span style="font-weight: bold; color: #008000; ">&lt;/min-samples&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;max-samples&gt;</span>250<span style="font-weight: bold; color: #008000; ">&lt;/max-samples&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;step-samples&gt;</span>10<span style="font-weight: bold; color: #008000; ">&lt;/step-samples&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/sampling-scale&gt;</span></div><h3 id="HChannelInfo"><span>Channel Info</span></h3><p>The <strong>ChannelInfo</strong> element is used to define one channel, or output, of the experiment. One basic sample of a channel configuration is:</p><div class="box code"><span style="font-weight: bold; color: #008000; ">&lt;ChannelInfo</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"rollpaper$rec.exp.rollpaper.hardwareinfo.channel.0.name"</span><br/> <span style="color: #7D9029; ">independent=</span><span style="color: #BA2121; ">"false"</span> <span style="color: #7D9029; ">direction=</span><span style="color: #BA2121; ">"CHANNEL_INPUT"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;scale</span> <span style="color: #7D9029; ">label=</span><span style="color: #BA2121; ">"rollpaper$rec.exp.rollpaper.hardwareinfo.channel.0.label"</span><br/> &nbsp;&nbsp;<span style="color: #7D9029; ">physicsunitname=</span><span style="color: #BA2121; ">"rollpaper$rec.exp.rollpaper.hardwareinfo.channel.0.physicsunitname"</span><br/> &nbsp;&nbsp;<span style="color: #7D9029; ">physicsunitsymbol=</span><span style="color: #BA2121; ">"m"</span> <span style="color: #7D9029; ">multiplier=</span><span style="color: #BA2121; ">"none"</span> <span style="color: #7D9029; ">selected=</span><span style="color: #BA2121; ">"true"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;min&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"float"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>10<span style="font-weight: bold; color: #008000; ">&lt;/PhysicsVal&gt;&lt;/min&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;max&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"float"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>100<span style="font-weight: bold; color: #008000; ">&lt;/PhysicsVal&gt;&lt;/max&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;step&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"float"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>1<span style="font-weight: bold; color: #008000; ">&lt;/PhysicsVal&gt;&lt;/step&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;errordefault&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"float"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>1E-5<span style="font-weight: bold; color: #008000; ">&lt;/PhysicsVal&gt;&lt;/errordefault&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;/scale&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/ChannelInfo&gt;</span></div><p>The <strong>ChannelInfo</strong> <em>name</em> represents the name of the channel. It's a property file defined in the experiment's messages.properties in the resources package of the client (see <span class="wikilink"><a href="https://xwiki-dev.linkare.com/bin/view/Product_ReC/HowToCreateExperimentGUI">Creating an Experiment GUI</a></span>). The <em>direction</em> can be CHANNEL_INPUT or CHANNEL_OUTPUT.</p><p>A channel must define a <strong>scale</strong>. The <em>label</em> matches the value showed in the data tables on the client table display. The same for the <em>physicsunitsymbol</em>. The <em>label</em> and the <em>physicsunitname</em> should also be in a properties file, to allow internationalization. The <em>multiplier</em> was explained above, and has the same possible values of frequency scale.</p><p>A scale includes four different <strong>PhysicsVal</strong>:</p><ul><li><strong>min</strong>: the minimum value that goes thru the channel.</li><li><strong>max</strong>: the maximum value that goes thru the channel.</li><li><strong>step</strong>: the difference in value between two consecutive possible values in the channel.</li><li><strong>errordefault</strong>: the error of the channel.</li></ul><p>The <em>type</em> of the <strong>PhysicsVal</strong> can have the following values:</p><ul><li>boolean (with any of the pairs on/off, yes/no, true/false, 1/0 being valid)</li><li>byte</li><li>short</li><li>int</li><li>long</li><li>float</li><li>double</li><li>byteArray (requires that another attribute named <em>mimetype</em> is given. Also need that an <em>href</em> or a <em>file</em> attribute is present)</li></ul><p>Here's the rest of the channel configuration for the rollpaper example:</p><div class="box code"><span style="font-weight: bold; color: #008000; ">&lt;ChannelInfo</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"rollpaper$rec.exp.rollpaper.hardwareinfo.channel.1.name"</span><br/> <span style="color: #7D9029; ">independent=</span><span style="color: #BA2121; ">"false"</span> <span style="color: #7D9029; ">direction=</span><span style="color: #BA2121; ">"CHANNEL_INPUT"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;scale</span> <span style="color: #7D9029; ">label=</span><span style="color: #BA2121; ">"rollpaper$rec.exp.rollpaper.hardwareinfo.channel.1.label"</span><br/> &nbsp;&nbsp;<span style="color: #7D9029; ">physicsunitname=</span><span style="color: #BA2121; ">"rollpaper$rec.exp.rollpaper.hardwareinfo.channel.1.physicsunitname"</span><br/> &nbsp;&nbsp;<span style="color: #7D9029; ">physicsunitsymbol=</span><span style="color: #BA2121; ">"m"</span> <span style="color: #7D9029; ">multiplier=</span><span style="color: #BA2121; ">"none"</span> <span style="color: #7D9029; ">selected=</span><span style="color: #BA2121; ">"true"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;min&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"float"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>10<span style="font-weight: bold; color: #008000; ">&lt;/PhysicsVal&gt;&lt;/min&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;max&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"float"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>100<span style="font-weight: bold; color: #008000; ">&lt;/PhysicsVal&gt;&lt;/max&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;step&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"float"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>1<span style="font-weight: bold; color: #008000; ">&lt;/PhysicsVal&gt;&lt;/step&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;errordefault&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"float"</span><span style="font-weight: bold; color: #008000; ">&gt;</span>1E-5<span style="font-weight: bold; color: #008000; ">&lt;/PhysicsVal&gt;&lt;/errordefault&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;/scale&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/ChannelInfo&gt;</span><br/><br/><span style="font-weight: bold; color: #008000; ">&lt;ChannelInfo</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"rollpaper$rec.exp.rollpaper.hardwareinfo.channel.2.name"</span><br/> <span style="color: #7D9029; ">independent=</span><span style="color: #BA2121; ">"false"</span> <span style="color: #7D9029; ">direction=</span><span style="color: #BA2121; ">"CHANNEL_INPUT"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;scale</span> <span style="color: #7D9029; ">label=</span><span style="color: #BA2121; ">"rollpaper$rec.exp.rollpaper.hardwareinfo.channel.2.label"</span><br/> &nbsp;&nbsp;<span style="color: #7D9029; ">physicsunitname=</span><span style="color: #BA2121; ">"rollpaper$rec.exp.rollpaper.hardwareinfo.channel.2.physicsunitname"</span><br/> &nbsp;&nbsp;<span style="color: #7D9029; ">physicsunitsymbol=</span><span style="color: #BA2121; ">"m"</span> <span style="color: #7D9029; ">multiplier=</span><span style="color: #BA2121; ">"none"</span> <span style="color: #7D9029; ">selected=</span><span style="color: #BA2121; ">"true"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;min&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"byteArray"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">href=</span><span style="color: #BA2121; ">"recresource:///pt/utl/ist/elab/driver/rollpaper/resources/RollpaperByteArray.txt"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">mimetype=</span><span style="color: #BA2121; ">"image/jpeg"</span> <span style="font-weight: bold; color: #008000; ">/&gt;&lt;/min&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;max&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"byteArray"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">href=</span><span style="color: #BA2121; ">"recresource:///pt/utl/ist/elab/driver/rollpaper/resources/RollpaperByteArray.txt"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">mimetype=</span><span style="color: #BA2121; ">"image/jpeg"</span> <span style="font-weight: bold; color: #008000; ">/&gt;&lt;/max&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;step&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"byteArray"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">href=</span><span style="color: #BA2121; ">"recresource:///pt/utl/ist/elab/driver/rollpaper/resources/RollpaperByteArray.txt"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">mimetype=</span><span style="color: #BA2121; ">"image/jpeg"</span> <span style="font-weight: bold; color: #008000; ">/&gt;&lt;/step&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;errordefault&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"byteArray"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">href=</span><span style="color: #BA2121; ">"recresource:///pt/utl/ist/elab/driver/rollpaper/resources/RollpaperByteArray.txt"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">mimetype=</span><span style="color: #BA2121; ">"image/jpeg"</span> <span style="font-weight: bold; color: #008000; ">/&gt;&lt;/errordefault&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;/scale&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/ChannelInfo&gt;</span><br/><br/><span style="font-weight: bold; color: #008000; ">&lt;ChannelInfo</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"rollpaper$rec.exp.rollpaper.hardwareinfo.channel.3.name"</span><br/> <span style="color: #7D9029; ">independent=</span><span style="color: #BA2121; ">"false"</span> <span style="color: #7D9029; ">direction=</span><span style="color: #BA2121; ">"CHANNEL_INPUT"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;scale</span> <span style="color: #7D9029; ">label=</span><span style="color: #BA2121; ">"rollpaper$rec.exp.rollpaper.hardwareinfo.channel.3.label"</span><br/> &nbsp;&nbsp;<span style="color: #7D9029; ">physicsunitname=</span><span style="color: #BA2121; ">"rollpaper$rec.exp.rollpaper.hardwareinfo.channel.3.physicsunitname"</span><br/> &nbsp;&nbsp;<span style="color: #7D9029; ">physicsunitsymbol=</span><span style="color: #BA2121; ">"m"</span> <span style="color: #7D9029; ">multiplier=</span><span style="color: #BA2121; ">"none"</span> <span style="color: #7D9029; ">selected=</span><span style="color: #BA2121; ">"true"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;min&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"byteArray"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">href=</span><span style="color: #BA2121; ">"recresource:///pt/utl/ist/elab/driver/rollpaper/resources/RollpaperByteArray.txt"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">mimetype=</span><span style="color: #BA2121; ">"image/jpeg"</span> <span style="font-weight: bold; color: #008000; ">/&gt;&lt;/min&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;max&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"byteArray"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">href=</span><span style="color: #BA2121; ">"recresource:///pt/utl/ist/elab/driver/rollpaper/resources/RollpaperByteArray.txt"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">mimetype=</span><span style="color: #BA2121; ">"image/jpeg"</span> <span style="font-weight: bold; color: #008000; ">/&gt;&lt;/max&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;step&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"byteArray"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">href=</span><span style="color: #BA2121; ">"recresource:///pt/utl/ist/elab/driver/rollpaper/resources/RollpaperByteArray.txt"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">mimetype=</span><span style="color: #BA2121; ">"image/jpeg"</span> <span style="font-weight: bold; color: #008000; ">/&gt;&lt;/step&gt;</span><br/> &nbsp;<span style="font-weight: bold; color: #008000; ">&lt;errordefault&gt;&lt;PhysicsVal</span> <span style="color: #7D9029; ">type=</span><span style="color: #BA2121; ">"byteArray"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">href=</span><span style="color: #BA2121; ">"recresource:///pt/utl/ist/elab/driver/rollpaper/resources/RollpaperByteArray.txt"</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7D9029; ">mimetype=</span><span style="color: #BA2121; ">"image/jpeg"</span> <span style="font-weight: bold; color: #008000; ">/&gt;&lt;/errordefault&gt;</span><br/> <span style="font-weight: bold; color: #008000; ">&lt;/scale&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;/ChannelInfo&gt;</span></div><p>Please, be aware that the used xml parser doesn't handle well spaces and line breaks, so try to keep the formatting of the <strong>scale</strong> and <strong>frequency-scale</strong> child elements as shown in the examples. Not doing this might cause parsing errors hard to find.</p><h2 id="HStep4-CreatetheDataSourceClass"><span>Step 4 - Create the DataSource Class</span></h2><p>The datasource class is responsible to collect the data sent by the hardware and store it temporarily, until a certain number of samples was collected or until a certain amount of time has passed. When one of these conditions is met, the samples currently stored in the data source are dispatched to the multicast controller, which will in turn deliver the samples to any interested client. In that moment, the data source clears its memory of the samples that were just sent and keeps collecting samples from the hardware. In the case of a virtual experiment, like our example, the data source is also responsible to generate "simulated" data.</p><h3 id="HChoosingtherightparentclass2Finterface-1"><span>Choosing the right parent class/interface</span></h3><p>Much like the driver, it is represented by a single interface: <span class="box code">com.linkare.rec.impl.driver.IDataSource</span>. The ReC framework also provides some base implementation in the form of the abstract class <span class="box code">com.linkare.rec.impl.driver.BaseDataSource</span>. eLab provides some abstract classes with more specific behaviour that can be extended by a data source implementation.</p><p><img src="http://www.plantuml.com/plantuml/img/2qfrrlDqIIn93CulBKfELR2fqTDJ208AEYKMfoB4URamnO1gTNKLKdqIa_GSaufBYXAJIu9JYp8JSmBoYqgGjH9KWcIIUseUK44oTeE8SqD9Ocu1qRh2CejAIXDpKEK1" style="max-width:100%" alt="http://www.plantuml.com/plantuml/img/2qfrrlDqIIn93CulBKfELR2fqTDJ208AEYKMfoB4URamnO1gTNKLKdqIa_GSaufBYXAJIu9JYp8JSmBoYqgGjH9KWcIIUseUK44oTeE8SqD9Ocu1qRh2CejAIXDpKEK1"/></p><p>In the rollpaper example, we'll extend from <span class="box code">com.linkare.rec.impl.driver.BaseDataSource</span>.</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> <span style="font-weight: bold; color: #008000; ">class</span> <span style="font-weight: bold; color: #0000FF; ">RollPaperDataSource</span> <span style="font-weight: bold; color: #008000; ">extends</span> BaseDataSource <span style="color: #666666; ">{</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">int</span> NUM_CHANNELS <span style="color: #666666; ">=</span> <span style="color: #666666; ">4</span><span style="color: #666666; ">;</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="color: #B00040; ">int</span> tbs<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">int</span> nSamples<span style="color: #666666; ">;</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> RollPaperDriver driver <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">null</span><span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> RollpaperHardwareSimulator samplesGenerator<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="color: #B00040; ">boolean</span> stopped <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">false</span><span style="color: #666666; ">;</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">public</span> <span style="color: #0000FF; ">RollPaperDataSource</span><span style="color: #666666; ">(</span>RollPaperDriver rollPaperDriver<span style="color: #666666; ">,</span> <span style="color: #B00040; ">float</span> baseHeight1<span style="color: #666666; ">,</span> <span style="color: #B00040; ">float</span> baseHeight2<span style="color: #666666; ">,</span> <span style="color: #B00040; ">float</span> g<span style="color: #666666; ">,</span> <span style="color: #B00040; ">float</span> totalRadius<span style="color: #666666; ">,</span> <span style="color: #B00040; ">float</span> innerRadius<span style="color: #666666; ">,</span> <span style="color: #B00040; ">int</span> tbs<span style="color: #666666; ">,</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #B00040; ">int</span> nSamples<span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">driver</span> <span style="color: #666666; ">=</span> rollPaperDriver<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">nSamples</span> <span style="color: #666666; ">=</span> nSamples<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">tbs</span> <span style="color: #666666; ">=</span> tbs<span style="color: #666666; ">;</span><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;samplesGenerator <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">new</span> RollpaperHardwareSimulator<span style="color: #666666; ">(</span>NUM_CHANNELS<span style="color: #666666; ">,</span> baseHeight1<span style="color: #666666; ">,</span> baseHeight2<span style="color: #666666; ">,</span> g<span style="color: #666666; ">,</span> totalRadius<span style="color: #666666; ">,</span> innerRadius<span style="color: #666666; ">,</span> getAcquisitionHeader<span style="color: #666666; ">());</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span></div><p>Please, note that the constructor receives all the parameters and creates an object of the type <span class="box code">pt.utl.ist.elab.driver.rollpaper.RollpaperHardwareSimulator</span>. This is just an auxiliary class for this experiment. It acts as the physical hardware, from where the data source will receive the data samples. We'll see the implementation of this class ahead in this tutorial.</p><h3 id="HImplementtheproducerthread"><span>Implement the producer thread</span></h3><p>The samples must be received and processed in a thread other than the hardware server's main thread, which means we need to start our own thread. Let's begin by creating our thread class, in this case, as an inner class:</p><div class="box code"><span style="font-weight: bold; color: #008000; ">private</span> <span style="font-weight: bold; color: #008000; ">class</span> <span style="font-weight: bold; color: #0000FF; ">ProducerThread</span> <span style="font-weight: bold; color: #008000; ">extends</span> Thread <span style="color: #666666; ">{</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="color: #B00040; ">int</span> currentSample <span style="color: #666666; ">=</span> <span style="color: #666666; ">0</span><span style="color: #666666; ">;</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="color: #AA22FF; ">@Override</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">public</span> <span style="color: #B00040; ">void</span> <span style="color: #0000FF; ">run</span><span style="color: #666666; ">()</span> <span style="color: #666666; ">{</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">try</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread<span style="color: #666666; ">.</span><span style="color: #7D9029; ">sleep</span><span style="color: #666666; ">(</span><span style="color: #666666; ">1000</span><span style="color: #666666; ">);</span><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PhysicsValue<span style="color: #666666; ">[]</span> value<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #B00040; ">int</span> counter <span style="color: #666666; ">=</span> <span style="color: #666666; ">0</span><span style="color: #666666; ">;</span><br/><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">while</span> <span style="color: #666666; ">(</span>currentSample <span style="color: #666666; ">&lt;</span> nSamples <span style="color: #666666; ">&amp;&amp;</span> <span style="color: #666666; ">!</span>stopped<span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">if</span> <span style="color: #666666; ">(</span>counter <span style="color: #666666; ">%</span> tbs <span style="color: #666666; ">==</span> <span style="color: #666666; ">0</span><span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value <span style="color: #666666; ">=</span> samplesGenerator<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getNewSample</span><span style="color: #666666; ">(</span><span style="color: #666666; ">1</span> <span style="color: #666666; ">/</span> tbs <span style="color: #666666; ">*</span> currentSample<span style="color: #666666; ">);</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addDataRow<span style="color: #666666; ">(</span>value<span style="color: #666666; ">);</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread<span style="color: #666666; ">.</span><span style="color: #7D9029; ">sleep</span><span style="color: #666666; ">(</span>tbs<span style="color: #666666; ">);</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currentSample<span style="color: #666666; ">++;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;counter<span style="color: #666666; ">++;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;join<span style="color: #666666; ">(</span><span style="color: #666666; ">100</span><span style="color: #666666; ">);</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endProduction<span style="color: #666666; ">();</span><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;driver<span style="color: #666666; ">.</span><span style="color: #7D9029; ">stopVirtualHardware</span><span style="color: #666666; ">();</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span> <span style="font-weight: bold; color: #008000; ">catch</span> <span style="color: #666666; ">(</span><span style="font-weight: bold; color: #008000; ">final</span> InterruptedException ie<span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoggerUtil<span style="color: #666666; ">.</span><span style="color: #7D9029; ">logThrowable</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"Error in Thread: "</span><span style="color: #666666; ">,</span> ie<span style="color: #666666; ">,</span> Logger<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getLogger</span><span style="color: #666666; ">(</span>RollPaperDriver<span style="color: #666666; ">.</span><span style="color: #7D9029; ">ROLLPAPER_DRIVER_LOGGER</span><span style="color: #666666; ">));</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/><span style="color: #666666; ">}</span><br/><br/><span style="font-weight: bold; color: #008000; ">private</span> <span style="color: #B00040; ">void</span> <span style="color: #0000FF; ">endProduction</span><span style="color: #666666; ">()</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;stopped <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">true</span><span style="color: #666666; ">;</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;setDataSourceEnded<span style="color: #666666; ">();</span><br/><span style="color: #666666; ">}</span></div><p>As you see, the producer thread delegates the samples production in the RollpaperHardwareSimulator. The Thread is only responsible to control the flow of the samples production. As you see, after each iteration, the Thread sleeps for the frequency time, to simulate the parametrized frequency.</p><p>At the end of the production of all the samples, it notifies it's listener that the production ended and notifies the driver that the virtual hardware terminated generating samples.</p><p>The method <em>endProduction</em> is an auxiliary method used to notify the data source listener that the data feed has reached the end (the maximum number of samples was received).</p><h3 id="HImplementthemethodtostartproducingsamples"><span>Implement the method to start producing samples</span></h3><p>As you may remember, in the driver's <em>start</em> method, the <em>startProduction</em> method of the datasource was called. The method name is not mandatory (it is not defined in any interface), but it is necessary to create in the datasource some method to start producing data.</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> <span style="color: #B00040; ">void</span> <span style="color: #0000FF; ">startProduction</span><span style="color: #666666; ">()</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;stopped <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">false</span><span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">new</span> <span style="color: #0000FF; ">ProducerThread</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">start</span><span style="color: #666666; ">();</span><br/><span style="color: #666666; ">}</span></div><h3 id="HImplementthemethodtostopproducingsamples"><span>Implement the method to stop producing samples</span></h3><p>This method is called by the driver when the <em>stop</em> method of the driver is called.</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> <span style="color: #B00040; ">void</span> <span style="color: #0000FF; ">stopNow</span><span style="color: #666666; ">()</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;stopped <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">true</span><span style="color: #666666; ">;</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;setDataSourceStoped<span style="color: #666666; ">();</span><br/><span style="color: #666666; ">}</span></div><h3 id="HImplementtheauxiliaryclassRollpaperHardwareSimulator"><span>Implement the auxiliary class RollpaperHardwareSimulator</span></h3><p>As mencioned earlier, this class simulates the physical hardware and creates the data that the datasource will receive and store.</p><p>This is the class declaration, attributes and constructor:</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> <span style="font-weight: bold; color: #008000; ">class</span> <span style="font-weight: bold; color: #0000FF; ">RollpaperHardwareSimulator</span> <span style="color: #666666; ">{</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">int</span> numChannels<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">double</span> baseHeight1<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">double</span> baseHeight2<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">double</span> gravityAcceleration<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">double</span> totalRadius<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="font-weight: bold; color: #008000; ">final</span> <span style="color: #B00040; ">double</span> innerRadius<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="font-weight: bold; color: #008000; ">final</span> HardwareAcquisitionConfig hardwareConfig<span style="color: #666666; ">;</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="color: #B00040; ">double</span> rollAcceleration<span style="color: #666666; ">;</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">public</span> <span style="color: #0000FF; ">RollpaperHardwareSimulator</span><span style="color: #666666; ">(</span><span style="color: #B00040; ">int</span> numChannels<span style="color: #666666; ">,</span> <span style="color: #B00040; ">double</span> baseHeight1<span style="color: #666666; ">,</span> <span style="color: #B00040; ">double</span> baseHeight2<span style="color: #666666; ">,</span> <span style="color: #B00040; ">double</span> g<span style="color: #666666; ">,</span> <span style="color: #B00040; ">double</span> totalRadius<span style="color: #666666; ">,</span> <span style="color: #B00040; ">double</span> innerRadius<span style="color: #666666; ">,</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HardwareAcquisitionConfig hardwareConfig<span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">numChannels</span> <span style="color: #666666; ">=</span> numChannels<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">baseHeight1</span> <span style="color: #666666; ">=</span> baseHeight1<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">baseHeight2</span> <span style="color: #666666; ">=</span> baseHeight2<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">gravityAcceleration</span> <span style="color: #666666; ">=</span> g<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">totalRadius</span> <span style="color: #666666; ">=</span> totalRadius<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">innerRadius</span> <span style="color: #666666; ">=</span> innerRadius<span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">hardwareConfig</span> <span style="color: #666666; ">=</span> hardwareConfig<span style="color: #666666; ">;</span><br/><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">rollAcceleration</span> <span style="color: #666666; ">=</span> getRollAcceleration<span style="color: #666666; ">().</span><span style="color: #7D9029; ">doubleValue</span><span style="color: #666666; ">();</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span></div><p>In this case, the constructor only sets the configuration for the "virtual hardware".</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> PhysicsValue<span style="color: #666666; ">[]</span> <span style="color: #0000FF; ">getNewSample</span><span style="color: #666666; ">(</span><span style="color: #B00040; ">double</span> time<span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;PhysicsValue<span style="color: #666666; ">[]</span> value <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">null</span><span style="color: #666666; ">;</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="color: #B00040; ">double</span> heightHeld <span style="color: #666666; ">=</span> getCurrentHeight<span style="color: #666666; ">(</span>baseHeight1<span style="color: #666666; ">,</span> time<span style="color: #666666; ">,</span> rollAcceleration<span style="color: #666666; ">).</span><span style="color: #7D9029; ">doubleValue</span><span style="color: #666666; ">();</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #B00040; ">double</span> heightFreefall <span style="color: #666666; ">=</span> getCurrentHeight<span style="color: #666666; ">(</span>baseHeight2<span style="color: #666666; ">,</span> time<span style="color: #666666; ">,</span> gravityAcceleration<span style="color: #666666; ">).</span><span style="color: #7D9029; ">doubleValue</span><span style="color: #666666; ">();</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #B00040; ">byte</span><span style="color: #666666; ">[]</span> snapshotHeld <span style="color: #666666; ">=</span> getSnapshot<span style="color: #666666; ">();</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #B00040; ">byte</span><span style="color: #666666; ">[]</span> snapshotFreeFall <span style="color: #666666; ">=</span> getSnapshot<span style="color: #666666; ">();</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">if</span> <span style="color: #666666; ">(</span>snapshotHeld <span style="color: #666666; ">==</span> <span style="font-weight: bold; color: #008000; ">null</span> <span style="color: #666666; ">&amp;&amp;</span> snapshotFreeFall <span style="color: #666666; ">==</span> <span style="font-weight: bold; color: #008000; ">null</span><span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">new</span> PhysicsValue<span style="color: #666666; ">[</span>numChannels <span style="color: #666666; ">-</span> <span style="color: #666666; ">2</span><span style="color: #666666; ">];</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span> <span style="font-weight: bold; color: #008000; ">else</span> <span style="font-weight: bold; color: #008000; ">if</span> <span style="color: #666666; ">(</span>snapshotFreeFall <span style="color: #666666; ">==</span> <span style="font-weight: bold; color: #008000; ">null</span><span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">new</span> PhysicsValue<span style="color: #666666; ">[</span>numChannels <span style="color: #666666; ">-</span> <span style="color: #666666; ">1</span><span style="color: #666666; ">];</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span> <span style="font-weight: bold; color: #008000; ">else</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">new</span> PhysicsValue<span style="color: #666666; ">[</span>numChannels<span style="color: #666666; ">];</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;value<span style="color: #666666; ">[</span><span style="color: #666666; ">0</span><span style="color: #666666; ">]</span> <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">new</span> PhysicsValue<span style="color: #666666; ">(</span>PhysicsValFactory<span style="color: #666666; ">.</span><span style="color: #7D9029; ">fromDouble</span><span style="color: #666666; ">(</span>heightHeld<span style="color: #666666; ">),</span> hardwareConfig<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getChannelsConfig</span><span style="color: #666666; ">(</span><span style="color: #666666; ">0</span><span style="color: #666666; ">).</span><span style="color: #7D9029; ">getSelectedScale</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">getDefaultErrorValue</span><span style="color: #666666; ">(),</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hardwareConfig<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getChannelsConfig</span><span style="color: #666666; ">(</span><span style="color: #666666; ">0</span><span style="color: #666666; ">).</span><span style="color: #7D9029; ">getSelectedScale</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">getMultiplier</span><span style="color: #666666; ">());</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;value<span style="color: #666666; ">[</span><span style="color: #666666; ">1</span><span style="color: #666666; ">]</span> <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">new</span> PhysicsValue<span style="color: #666666; ">(</span>PhysicsValFactory<span style="color: #666666; ">.</span><span style="color: #7D9029; ">fromDouble</span><span style="color: #666666; ">(</span>heightFreefall<span style="color: #666666; ">),</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hardwareConfig<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getChannelsConfig</span><span style="color: #666666; ">(</span><span style="color: #666666; ">1</span><span style="color: #666666; ">).</span><span style="color: #7D9029; ">getSelectedScale</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">getDefaultErrorValue</span><span style="color: #666666; ">(),</span> hardwareConfig<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getChannelsConfig</span><span style="color: #666666; ">(</span><span style="color: #666666; ">1</span><span style="color: #666666; ">)</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getSelectedScale</span><span style="color: #666666; ">()</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getMultiplier</span><span style="color: #666666; ">());</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">if</span> <span style="color: #666666; ">(</span>value<span style="color: #666666; ">.</span><span style="color: #7D9029; ">length</span> <span style="color: #666666; ">&gt;</span> <span style="color: #666666; ">1</span><span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value<span style="color: #666666; ">[</span><span style="color: #666666; ">2</span><span style="color: #666666; ">]</span> <span style="color: #666666; ">=</span> snapshotHeld <span style="color: #666666; ">!=</span> <span style="font-weight: bold; color: #008000; ">null</span> <span style="color: #666666; ">?</span> <span style="font-weight: bold; color: #008000; ">new</span> PhysicsValue<span style="color: #666666; ">(</span>PhysicsValFactory<span style="color: #666666; ">.</span><span style="color: #7D9029; ">fromByteArray</span><span style="color: #666666; ">(</span>snapshotHeld<span style="color: #666666; ">,</span> <span style="color: #BA2121; ">"image/gif"</span><span style="color: #666666; ">),</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hardwareConfig<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getChannelsConfig</span><span style="color: #666666; ">(</span><span style="color: #666666; ">2</span><span style="color: #666666; ">).</span><span style="color: #7D9029; ">getSelectedScale</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">getDefaultErrorValue</span><span style="color: #666666; ">(),</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hardwareConfig<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getChannelsConfig</span><span style="color: #666666; ">(</span><span style="color: #666666; ">2</span><span style="color: #666666; ">).</span><span style="color: #7D9029; ">getSelectedScale</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">getMultiplier</span><span style="color: #666666; ">())</span> <span style="color: #666666; ">:</span> <span style="font-weight: bold; color: #008000; ">null</span><span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">if</span> <span style="color: #666666; ">(</span>value<span style="color: #666666; ">.</span><span style="color: #7D9029; ">length</span> <span style="color: #666666; ">&gt;</span> <span style="color: #666666; ">2</span><span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value<span style="color: #666666; ">[</span><span style="color: #666666; ">3</span><span style="color: #666666; ">]</span> <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">new</span> PhysicsValue<span style="color: #666666; ">(</span>PhysicsValFactory<span style="color: #666666; ">.</span><span style="color: #7D9029; ">fromByteArray</span><span style="color: #666666; ">(</span>snapshotFreeFall<span style="color: #666666; ">,</span> <span style="color: #BA2121; ">"image/gif"</span><span style="color: #666666; ">),</span> hardwareConfig<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getChannelsConfig</span><span style="color: #666666; ">(</span><span style="color: #666666; ">3</span><span style="color: #666666; ">).</span><span style="color: #7D9029; ">getSelectedScale</span><span style="color: #666666; ">()</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getDefaultErrorValue</span><span style="color: #666666; ">(),</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hardwareConfig<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getChannelsConfig</span><span style="color: #666666; ">(</span><span style="color: #666666; ">3</span><span style="color: #666666; ">).</span><span style="color: #7D9029; ">getSelectedScale</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">getMultiplier</span><span style="color: #666666; ">());</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">return</span> value<span style="color: #666666; ">;</span><br/><span style="color: #666666; ">}</span></div><p>Returns one single sample of data, with a <span class="box code">com.linkare.rec.data.acquisition.PhysicsVal</span> for each channel.</p><p>Please note that if the last channels have null values, those columns will not be sent. ReC supports not sending the last columns if null, to avoid sending these values, which are expensive in corba. To the current date, there was no performance problems that justify not sending the null values when they are present, so this functionality was lightly tested. Using this approach might lead you to face some problems with the multicast controller when deserializing a sample with less columns than the number of expected channels.</p><p>So, if your experiment's performance is low and you need to cut somewhere, not sending null values in the last channels is a good place to start.</p><p>To complete the rollpaper example:</p><div class="box code"><span style="font-weight: bold; color: #008000; ">private</span> <span style="color: #B00040; ">byte</span><span style="color: #666666; ">[]</span> <span style="color: #0000FF; ">getSnapshot</span><span style="color: #666666; ">()</span> <span style="color: #666666; ">{</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">if</span> <span style="color: #666666; ">(</span>Math<span style="color: #666666; ">.</span><span style="color: #7D9029; ">random</span><span style="color: #666666; ">()</span> <span style="color: #666666; ">&lt;</span> <span style="color: #666666; ">0.3</span><span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">return</span> <span style="font-weight: bold; color: #008000; ">null</span><span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">try</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputStream is <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">this</span><span style="color: #666666; ">.</span><span style="color: #7D9029; ">getClass</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">getClassLoader</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">getResourceAsStream</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"pt/utl/ist/elab/driver/rollpaper/resources/test.gif"</span><span style="color: #666666; ">);</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #B00040; ">byte</span><span style="color: #666666; ">[]</span> buffer <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">new</span> <span style="color: #B00040; ">byte</span><span style="color: #666666; ">[</span><span style="color: #666666; ">1024</span><span style="color: #666666; ">];</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteArrayOutputStream baos <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">new</span> ByteArrayOutputStream<span style="color: #666666; ">();</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">while</span> <span style="color: #666666; ">(</span>is<span style="color: #666666; ">.</span><span style="color: #7D9029; ">read</span><span style="color: #666666; ">(</span>buffer<span style="color: #666666; ">)</span> <span style="color: #666666; ">&gt;</span> <span style="color: #666666; ">0</span><span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;baos<span style="color: #666666; ">.</span><span style="color: #7D9029; ">write</span><span style="color: #666666; ">(</span>buffer<span style="color: #666666; ">);</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">return</span> baos<span style="color: #666666; ">.</span><span style="color: #7D9029; ">toByteArray</span><span style="color: #666666; ">();</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span> <span style="font-weight: bold; color: #008000; ">catch</span> <span style="color: #666666; ">(</span>IOException e<span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">return</span> <span style="font-weight: bold; color: #008000; ">null</span><span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/><span style="color: #666666; ">}</span><br/><br/><span style="font-weight: bold; color: #008000; ">private</span> BigDecimal <span style="color: #0000FF; ">getCurrentHeight</span><span style="color: #666666; ">(</span><span style="color: #B00040; ">double</span> baseHeight<span style="color: #666666; ">,</span> <span style="color: #B00040; ">double</span> time<span style="color: #666666; ">,</span> <span style="color: #B00040; ">double</span> acceleration<span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">return</span> <span style="font-weight: bold; color: #008000; ">new</span> <span style="color: #0000FF; ">BigDecimal</span><span style="color: #666666; ">(</span>baseHeight<span style="color: #666666; ">).</span><span style="color: #7D9029; ">subtract</span><span style="color: #666666; ">(</span>getDistance<span style="color: #666666; ">(</span>time<span style="color: #666666; ">,</span> acceleration<span style="color: #666666; ">));</span><br/><span style="color: #666666; ">}</span><br/><br/><span style="font-weight: bold; color: #008000; ">private</span> BigDecimal <span style="color: #0000FF; ">getDistance</span><span style="color: #666666; ">(</span><span style="color: #B00040; ">double</span> time<span style="color: #666666; ">,</span> <span style="color: #B00040; ">double</span> acceleration<span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">return</span> <span style="font-weight: bold; color: #008000; ">new</span> <span style="color: #0000FF; ">BigDecimal</span><span style="color: #666666; ">(</span>acceleration<span style="color: #666666; ">).</span><span style="color: #7D9029; ">multiply</span><span style="color: #666666; ">(</span><span style="font-weight: bold; color: #008000; ">new</span> BigDecimal<span style="color: #666666; ">(</span>time<span style="color: #666666; ">).</span><span style="color: #7D9029; ">pow</span><span style="color: #666666; ">(</span><span style="color: #666666; ">2</span><span style="color: #666666; ">)).</span><span style="color: #7D9029; ">divide</span><span style="color: #666666; ">(</span><span style="font-weight: bold; color: #008000; ">new</span> BigDecimal<span style="color: #666666; ">(</span><span style="color: #666666; ">2</span><span style="color: #666666; ">));</span><br/><span style="color: #666666; ">}</span><br/><br/><span style="font-weight: bold; color: #008000; ">private</span> BigDecimal <span style="color: #0000FF; ">getRollAcceleration</span><span style="color: #666666; ">()</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;BigDecimal numerator <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">new</span> BigDecimal<span style="color: #666666; ">(</span><span style="color: #666666; ">2</span><span style="color: #666666; ">).</span><span style="color: #7D9029; ">multiply</span><span style="color: #666666; ">(</span><span style="font-weight: bold; color: #008000; ">new</span> BigDecimal<span style="color: #666666; ">(</span>gravityAcceleration<span style="color: #666666; ">)).</span><span style="color: #7D9029; ">multiply</span><span style="color: #666666; ">(</span><span style="font-weight: bold; color: #008000; ">new</span> BigDecimal<span style="color: #666666; ">(</span>totalRadius<span style="color: #666666; ">).</span><span style="color: #7D9029; ">pow</span><span style="color: #666666; ">(</span><span style="color: #666666; ">2</span><span style="color: #666666; ">));</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;BigDecimal denominator <span style="color: #666666; ">=</span> <span style="font-weight: bold; color: #008000; ">new</span> BigDecimal<span style="color: #666666; ">(</span><span style="color: #666666; ">3</span><span style="color: #666666; ">).</span><span style="color: #7D9029; ">multiply</span><span style="color: #666666; ">(</span><span style="font-weight: bold; color: #008000; ">new</span> BigDecimal<span style="color: #666666; ">(</span>totalRadius<span style="color: #666666; ">).</span><span style="color: #7D9029; ">pow</span><span style="color: #666666; ">(</span><span style="color: #666666; ">2</span><span style="color: #666666; ">)).</span><span style="color: #7D9029; ">add</span><span style="color: #666666; ">(</span><span style="font-weight: bold; color: #008000; ">new</span> BigDecimal<span style="color: #666666; ">(</span>innerRadius<span style="color: #666666; ">).</span><span style="color: #7D9029; ">pow</span><span style="color: #666666; ">(</span><span style="color: #666666; ">2</span><span style="color: #666666; ">));</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">return</span> numerator<span style="color: #666666; ">.</span><span style="color: #7D9029; ">divide</span><span style="color: #666666; ">(</span>denominator<span style="color: #666666; ">);</span><br/><span style="color: #666666; ">}</span></div><h2 id="HStep5-CreatingtheServerMainClass"><span>Step 5 - Creating the ServerMain Class</span></h2><p>This is the executable java Main class which is invoked in the hardware server's start scripts. It is absolutely necessary it's existence for executing the experiment. The implementation should at least contain the statements in the example below.</p><div class="box code"><span style="font-weight: bold; color: #008000; ">public</span> <span style="font-weight: bold; color: #008000; ">class</span> <span style="font-weight: bold; color: #0000FF; ">ServerMain</span> <span style="color: #666666; ">{</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">private</span> <span style="font-weight: bold; color: #008000; ">static</span> String RollPaper_HARDWARE_LOGGER <span style="color: #666666; ">=</span> <span style="color: #BA2121; ">"RollPaper.Logger"</span><span style="color: #666666; ">;</span><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">static</span> <span style="color: #666666; ">{</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">final</span> Logger l <span style="color: #666666; ">=</span> LogManager<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getLogManager</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">getLogger</span><span style="color: #666666; ">(</span>ServerMain<span style="color: #666666; ">.</span><span style="color: #7D9029; ">RollPaper_HARDWARE_LOGGER</span><span style="color: #666666; ">);</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">if</span> <span style="color: #666666; ">(</span>l <span style="color: #666666; ">==</span> <span style="font-weight: bold; color: #008000; ">null</span><span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/>LogManager<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getLogManager</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">addLogger</span><span style="color: #666666; ">(</span>Logger<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getLogger</span><span style="color: #666666; ">(</span>ServerMain<span style="color: #666666; ">.</span><span style="color: #7D9029; ">RollPaper_HARDWARE_LOGGER</span><span style="color: #666666; ">));</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/><br/> &nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">public</span> <span style="font-weight: bold; color: #008000; ">static</span> <span style="color: #B00040; ">void</span> <span style="color: #0000FF; ">main</span><span style="color: #666666; ">(</span><span style="font-weight: bold; color: #008000; ">final</span> String<span style="color: #666666; ">[]</span> args<span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">try</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ORBBean<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getORBBean</span><span style="color: #666666; ">();</span><br/><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold; color: #008000; ">new</span> <span style="color: #0000FF; ">BaseHardware</span><span style="color: #666666; ">(</span><span style="font-weight: bold; color: #008000; ">new</span> RollPaperDriver<span style="color: #666666; ">());</span><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread<span style="color: #666666; ">.</span><span style="color: #7D9029; ">currentThread</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">join</span><span style="color: #666666; ">();</span><br/><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span> <span style="font-weight: bold; color: #008000; ">catch</span> <span style="color: #666666; ">(</span><span style="font-weight: bold; color: #008000; ">final</span> Exception e<span style="color: #666666; ">)</span> <span style="color: #666666; ">{</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ORBBean<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getORBBean</span><span style="color: #666666; ">().</span><span style="color: #7D9029; ">killORB</span><span style="color: #666666; ">();</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoggerUtil<span style="color: #666666; ">.</span><span style="color: #7D9029; ">logThrowable</span><span style="color: #666666; ">(</span><span style="color: #BA2121; ">"Error on Main..."</span><span style="color: #666666; ">,</span> e<span style="color: #666666; ">,</span> Logger<span style="color: #666666; ">.</span><span style="color: #7D9029; ">getLogger</span><span style="color: #666666; ">(</span>ServerMain<span style="color: #666666; ">.</span><span style="color: #7D9029; ">RollPaper_HARDWARE_LOGGER</span><span style="color: #666666; ">));</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/> &nbsp;&nbsp;&nbsp;<span style="color: #666666; ">}</span><br/><span style="color: #666666; ">}</span></div>
</div>


    <div class="clearfloats"></div>
  </div>
</body>
</html>


