<?xml version="1.0"?>
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">

	<p:panel id="organizationPanel" toggleable="false" collapsed="false"
		styleClass="configurations">
		<f:facet name="header">
			<legend>
				<h:outputText value="#{messages['organizations']}" />
			</legend>
		</f:facet>

		<p:messages autoUpdate="true" showDetail="true" showSummary="true"
			globalOnly="false" closable="true"
			for="globalOrganizationSpecificMessages" escape="false" />
		<h:panelGroup id="globalOrganizationSpecificMessages" />

		<h:outputText styleClass="tip"
			value="#{messages['organizations.upload.tip']}" escape="false" />

		<ui:include src="/protected/uploads/includes/migration_module.xhtml">
			<ui:param name="updateId" value=":form:uploadModules" />
			<ui:param name="title"
				value="#{messages['upload.organization.title']}" />
			<ui:param name="bean" value="#{organizationUploadController}" />
			<ui:param name="updatePanelId" value="organizationPanel" />
		</ui:include>

		<h:panelGroup id="organizationsTableGroup" layout="block"
			styleClass="row-fluid">
			<p:dataTable id="organizationsTable"
				value="#{organizationUploadController.dataModel}" var="organization"
				paginator="true" rows="#{organizationUploadController.rows}"
				first="#{organizationUploadController.first}" lazy="true"
				paginatorPosition="bottom" reflow="true" editable="true"
				paginatorAlwaysVisible="false" pageLinks="3"
				emptyMessage="#{messages['label.noResults']}">

				<f:facet name="header">
					<div class="results-count">
						<h:outputFormat value="#{messages['label.resultsCount']}">
							<f:param
								value="#{organizationUploadController.dataModel.rowCount}" />
						</h:outputFormat>
					</div>
					<div class="clearfix" />
				</f:facet>

				<p:ajax event="rowEdit"
					listener="#{organizationUploadController.onRowEdit}" update="@none"
					onstart="PF('mainContentBUI').show()"
					oncomplete="PF('mainContentBUI').hide()" />

				<p:column headerText="#{messages['organization.organizationType']}"
					colspan="1">
					<h:outputText
						value="#{messages[organization.organizationType.key]}" />
				</p:column>

				<p:column headerText="#{messages['organization.name']}" colspan="3">
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText value="#{organization.name}" />
						</f:facet>
						<f:facet name="input">
							<p:inputText id="organizationNameInput"
								value="#{organization.name}" styleClass="col-md-12"
								required="true" label="text">
								<f:validator
									validatorId="com.linkare.irn.nascimento.web.validator.ForbiddenEmailFieldValidator" />
							</p:inputText>
							<p:message for="organizationNameInput" />
						</f:facet>
					</p:cellEditor>
				</p:column>

				<p:column
					headerText="#{messages['organization.email']} / #{messages['organization.secondEmail']}"
					colspan="3">
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText value="#{organization.email}" />
							<ui:fragment
								rendered="#{organization.organizationType eq 'HOSPITAL_UNIT'}">
								<br />
								<h:outputText value="#{organization.secondEmail}"
									rendered="#{not empty organization.secondEmail}" />
								<h:outputText value="-"
									rendered="#{empty organization.secondEmail}" styleClass="muted" />
							</ui:fragment>
						</f:facet>
						<f:facet name="input">
							<p:inputText id="organizationEmailInput"
								value="#{organization.email}" styleClass="col-md-12"
								required="true" label="text"
								placeholder="#{messages['organization.email']}" />
							<p:message for="organizationEmailInput" />
							<ui:fragment
								rendered="#{organization.organizationType eq 'HOSPITAL_UNIT'}">
								<p:inputText id="organizationSecondEmailInput"
									value="#{organization.secondEmail}" styleClass="col-md-12"
									required="false" label="text"
									placeholder="#{messages['organization.secondEmail']}" />
								<p:message for="organizationSecondEmailInput" />
							</ui:fragment>
						</f:facet>
					</p:cellEditor>
				</p:column>

				<p:column headerText="#{messages['organization.active']}"
					colspan="1">
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText
								value="#{organization.active ? messages['label.yes'] : messages['label.no']}" />
						</f:facet>
						<f:facet name="input">
							<p:selectBooleanCheckbox id="organizationActiveInput"
								value="#{organization.active}" required="true" label="text" />
							<p:message for="organizationActiveInput" />
						</f:facet>
					</p:cellEditor>
				</p:column>

				<p:column styleClass="row-edit" width="40">
					<p:rowEditor />
				</p:column>
			</p:dataTable>
		</h:panelGroup>

	</p:panel>
</ui:composition>