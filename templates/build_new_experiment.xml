<?xml version="1.0" encoding="UTF-8"?>
<project name="Experiment" default="create.experiment" basedir=".">
	<description>Create the structure of a new experiment in the elab project</description>

	<property file="build.experiments.properties" />

	<property name="experiments.directory" value="../experiments" />

	<target name="check.experiment.exists">
		<fail unless="experiment.name">experiment.name must be set to build
			a single experiment directory structure. pass it to jvm as arg like
			-Dexperiment.name="experiment name"</fail>
		<available property="experiment.allready.exists" value="true" file="${experiments.directory}/${experiment.name}" type="dir">
		</available>
	</target>

	<target name="echo.message.experiment.allready.exists" if="experiment.allready.exists">
		<echo>Experiment directory ${experiments.directory}/${experiment.name} allready exists! Creating non existent files (existent files will not be overriden).</echo>
	</target>

	<target name="create.experiment" depends="check.experiment.exists,echo.message.experiment.allready.exists" unless="experiment.allready.exists">
		<fail unless="experiment.name">experiment.name must be set to build
			a single experiment directory structure. pass it to jvm as arg like
			-Dexperiment.name="experiment name"</fail>


		<mkdir dir="${experiments.directory}/${experiment.name}" />

		<copy todir="${experiments.directory}/${experiment.name}">
			<fileset dir="experiment" />
		</copy>

		<replace dir="${experiments.directory}/${experiment.name}" includes="**/**.*">
			<replacefilter token="@experiment.name@" value="${experiment.name}" />
		</replace>

		<propertyfile file="build.experiments.properties">
			<entry key="experiments.list" default="" operation="+" value=",${experiment.name}">
			</entry>
		</propertyfile>

	</target>

</project>
