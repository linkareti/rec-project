/*
 * DefaultExperimentGraph.java
 *
 * Created on 7 de Maio de 2003, 18:47
 */

package com.linkare.rec.impl.ui.graph;

import com.linkare.rec.impl.client.experiment.DataDisplayEnum;
import javax.swing.Icon;

import org.jfree.chart.ChartPanel;
import org.jfree.chart.JFreeChart;
import org.jfree.chart.axis.NumberAxis;
import org.jfree.chart.plot.XYPlot;
import org.jfree.chart.renderer.xy.XYBarRenderer;

import com.linkare.rec.data.config.HardwareAcquisitionConfig;
import com.linkare.rec.data.metadata.Scale;
import com.linkare.rec.impl.client.experiment.ExpDataDisplay;
import com.linkare.rec.impl.client.experiment.ExpDataModel;
import com.linkare.rec.impl.client.experiment.ExpDataModelListener;
import com.linkare.rec.impl.client.experiment.NewExpDataEvent;
import com.linkare.rec.impl.i18n.ReCResourceBundle;

/**
 * 
 * @author Jos√© Pedro Pereira - Linkare TI
 */
public class DefaultExperimentBarGraph extends javax.swing.JPanel implements ExpDataDisplay, ExpDataModelListener {
	/**
	 * 
	 */
	private static final long serialVersionUID = 790325971846177416L;

	/** Creates new form DefaultExperimentGraph */
	public DefaultExperimentBarGraph() {
		initComponents();
	}

	/**
	 * This method is called from within the constructor to initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	private void initComponents()//GEN-BEGIN:initComponents
	{
		defaultHistogramDatasetProxy = new com.linkare.rec.impl.client.experiment.DefaultHistogramDatasetProxy();
		scrollPane = new javax.swing.JScrollPane();
		labelWaitData = new javax.swing.JLabel();

		setLayout(new java.awt.BorderLayout());

		labelWaitData.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
		labelWaitData.setText("waiting for data...");
		scrollPane.setViewportView(labelWaitData);

		add(scrollPane, java.awt.BorderLayout.CENTER);

	}//GEN-END:initComponents

	// Variables declaration - do not modify//GEN-BEGIN:variables
	private javax.swing.JScrollPane scrollPane;
	private com.linkare.rec.impl.client.experiment.DefaultHistogramDatasetProxy defaultHistogramDatasetProxy;
	private javax.swing.JLabel labelWaitData;

	// End of variables declaration//GEN-END:variables

	@Override
	public javax.swing.JComponent getDisplay() {
		return this;
	}

	@Override
	public Icon getIcon() {
		return new javax.swing.ImageIcon(getClass().getResource("/com/linkare/rec/impl/newface/resources/legacy/chart16.gif"));
	}

	private ExpDataModel model = null;

	@Override
	public void setExpDataModel(final ExpDataModel model) {
		this.model = model;
		defaultHistogramDatasetProxy.setChannelDisplay(getChannelDisplay());
		defaultHistogramDatasetProxy.setExpDataModel(model);
		if (model != null) {
			model.addExpDataModelListener(this);
		}
	}

	@Override
	public String getName() {
		return "Histogram";
	}

	@Override
	public javax.swing.JMenuBar getMenuBar() {
		return null;
	}

	@Override
	public javax.swing.JToolBar getToolBar() {
		return null;
	}

	public void dataModelRunning() {// BIG SILENT NOOP
	}

	@Override
	public void dataModelStoped() {// BIG SILENT NOOP
	}

	/*
	 * public void headerAvailable(HardwareAcquisitionConfig header) {
	 * NumberAxis hitsAxis = new NumberAxis("Hits");
	 * hitsAxis.setAutoRange(true); hitsAxis.setAutoRangeStickyZero(false);
	 * hitsAxis.setAutoRangeIncludesZero(false);
	 * 
	 * com.linkare.rec.data.metadata.Scale
	 * scale=header.getChannelsConfig(getChannelDisplay()).getSelectedScale();
	 * String
	 * chn=header.getChannelsConfig(getChannelDisplay()).getChannelName();
	 * String pus=scale.getPhysicsUnitSymbol(); String
	 * multiplier=scale.getMultiplier().toString();
	 * 
	 * NumberAxis valueAxis = new NumberAxis(chn+" ["+multiplier+pus+"]");
	 * 
	 * //NumberAxis valueAxis = new VerticalNumberAxis("Acquisition Channels");
	 * valueAxis.setAutoRange(true); valueAxis.setAutoRangeStickyZero(false);
	 * valueAxis.setAutoRangeIncludesZero(false);
	 * 
	 * XYToolTipGenerator tooltipGenerator = new StandardXYToolTipGenerator();
	 * 
	 * XYPlot plot = new XYPlot(defaultHistogramDatasetProxy,valueAxis,hitsAxis,
	 * new XYBarRenderer(0.1));
	 * 
	 * chart = new JFreeChart(header.getFamiliarName(),
	 * JFreeChart.DEFAULT_TITLE_FONT, plot, true);
	 * 
	 * ChartPanel panel=new
	 * ChartPanel(chart,350,250,350,250,350,250,true,true,true,true,true,true);
	 * panel.setPreferredSize(new java.awt.Dimension(350,250));
	 * //panel.setMinimumSize(new java.awt.Dimension(350,250));
	 * //panel.setSize(new java.awt.Dimension(350,250));
	 * panel.setMouseZoomable(true,false);
	 * 
	 * scrollPane.remove(labelWaitData); scrollPane.setViewportView(panel);
	 * 
	 * }
	 */

//	private final boolean isScaleSet = false;

	private JFreeChart chart = null;

	/** Holds value of property channelDisplay. */
	private int channelDisplay = 0;

	@Override
	public void newSamples(final NewExpDataEvent evt) {

	}

	/**
	 * Getter for property channelDisplay.
	 * 
	 * @return Value of property channelDisplay.
	 */
	public int getChannelDisplay() {
		return channelDisplay;
	}

	/**
	 * Setter for property channelDisplay.
	 * 
	 * @param channelDisplay New value of property channelDisplay.
	 */
	public void setChannelDisplay(final int channelDisplay) {
		this.channelDisplay = channelDisplay;
		defaultHistogramDatasetProxy.setChannelDisplay(channelDisplay);
	}

	@Override
	public void dataModelEnded() {
	}

	@Override
	public void dataModelError() {
	}

	@Override
	public void dataModelStarted() {
		if (header == null) {
			headerAvailable(model.getAcquisitionConfig());
		}
	}

	private HardwareAcquisitionConfig header = null;
	
	private String NumberAxisName = new String("Hits"); 
	
	
	
	/**
	 * @return the numberAxisName
	 */
	public String getNumberAxisName() {
		return NumberAxisName;
	}

	/**
	 * @param numberAxisName the numberAxisName to set
	 * This method allows flexibility in setting the axis name while allowing for internationalization
	 */
	public void setNumberAxisName(String numberAxisName) {
		NumberAxisName = numberAxisName;
	}

	private void headerAvailable(final HardwareAcquisitionConfig header) {
		if (header == null) {
			return;
		}

		this.header = header;
		final NumberAxis hitsAxis = new NumberAxis(NumberAxisName);
		hitsAxis.setAutoRange(true);
		hitsAxis.setAutoRangeStickyZero(false);
		hitsAxis.setAutoRangeIncludesZero(false);

		final Scale scale = header.getChannelsConfig(getChannelDisplay()).getSelectedScale();
		String channelName = header.getChannelsConfig(getChannelDisplay()).getChannelName();
		final String chn = ReCResourceBundle.findStringOrDefault(channelName,channelName);
		final String pus = scale.getPhysicsUnitSymbol();
		final String multiplier = scale.getMultiplier().toString();	
		
		final NumberAxis valueAxis = new NumberAxis(chn + " [" + multiplier + pus + "]");
		valueAxis.setAutoRange(true);
		valueAxis.setAutoRangeStickyZero(false);
		valueAxis.setAutoRangeIncludesZero(false);

//		final XYToolTipGenerator tooltipGenerator = new StandardXYToolTipGenerator();

		final XYPlot plot = new XYPlot(defaultHistogramDatasetProxy, valueAxis, hitsAxis, new XYBarRenderer(0.1));

		chart = new JFreeChart(header.getFamiliarName(), JFreeChart.DEFAULT_TITLE_FONT, plot, true);
		final ChartPanel panel = new ChartPanel(chart);
		
		panel.setPreferredSize(new java.awt.Dimension(350, 300));
		// panel.setMinimumSize(new java.awt.Dimension(350,250));
		// panel.setSize(new java.awt.Dimension(350,250));
		panel.setMouseZoomable(true, false);

		scrollPane.remove(labelWaitData);
		scrollPane.setViewportView(panel);
	}

	@Override
	public void dataModelStartedNoData() {
		if (header == null) {
			headerAvailable(model.getAcquisitionConfig());
		}
	}

	@Override
	public void dataModelWaiting() {
	}

    @Override
    public DataDisplayEnum getDisplayType() {
        return DataDisplayEnum.CHART;
    }

}
