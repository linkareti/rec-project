<VirtualHost *:80>
    ServerName elab.dev.linkare.com
    
    ErrorLog /dev/stderr
    CustomLog /dev/stdout combined_cache_io env=!dontlog

    RewriteEngine on
    
    <Location "/rec.web">
        ProxyPass http://elab-server-payara:8080/rec.web
        ProxyPassReverse http://elab-server-payara:8080/rec.web
    </Location>

    RewriteCond %{REQUEST_URI} !^/rec\.web.*$ [NC]
    RewriteCond %{HTTP:Upgrade} =websocket
    RewriteRule /(.*) ws://elab-client-webswing:8080/$1 [P,L]

    RewriteCond %{REQUEST_URI} !^/rec\.web.*$ [NC]
    RewriteCond %{HTTP:Upgrade} !=websocket
    RewriteRule /(.*) http://elab-client-webswing:8080/$1 [P,L]

    ProxyPass "/" "http://elab-client-webswing:8080/"
    ProxyPassReverse "/" "http://elab-client-webswing:8080/"
</VirtualHost>
<VirtualHost *:443>
    ServerName elab.dev.linkare.com
    
    ErrorLog /dev/stderr
    CustomLog /dev/stdout combined_cache_io env=!dontlog

    #ProxyPreserveHost On
    #ProxyVia on
    RewriteEngine on
    
    #RequestHeader set X-Forwarded-Proto "https"
    
    # Configuracao SSL
    SSLEngine on

    <Location "/rec.web">
        ProxyPass http://elab-server-payara:8080/rec.web
        ProxyPassReverse http://elab-server-payara:8080/rec.web
    </Location>

    RewriteCond %{REQUEST_URI} !^/rec\.web.*$ [NC]
    RewriteCond %{HTTP:Upgrade} =websocket
    RewriteRule /(.*) ws://elab-client-webswing:8080/$1 [P,L]

    RewriteCond %{REQUEST_URI} !^/rec\.web.*$ [NC]
    RewriteCond %{HTTP:Upgrade} !=websocket
    RewriteRule /(.*) http://elab-client-webswing:8080/$1 [P,L]

    ProxyPass "/" "http://elab-client-webswing:8080/"
    ProxyPassReverse "/" "http://elab-client-webswing:8080/"

</VirtualHost>