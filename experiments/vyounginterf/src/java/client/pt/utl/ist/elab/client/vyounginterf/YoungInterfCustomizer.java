/*
 * YoungInterfCustomizer.java
 *
 * Created on 29 de Dezembro de 2004, 16:38
 */

package pt.utl.ist.elab.client.vyounginterf;

/**
 *
 * @author  Emanuel Antunes
 */

import java.awt.Dimension;

import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.SwingConstants;
import javax.swing.SwingUtilities;

import com.linkare.rec.data.config.HardwareAcquisitionConfig;
import com.linkare.rec.impl.client.customizer.AbstractCustomizer;
import com.linkare.rec.impl.i18n.ReCResourceBundle;

public class YoungInterfCustomizer  extends AbstractCustomizer {

	/**
	 * 
	 */
	private static final long serialVersionUID = 7256341455487365684L;

	/** Creates new form YoungInterfCustomizer */
	public YoungInterfCustomizer() {
		initWavelenghtChooser();
		initComponents();

		final java.util.Hashtable<Integer, JLabel> htDFendas = new java.util.Hashtable<Integer, JLabel>(7);
		for (int i = 0; i <= 600; i += 100) {
			htDFendas.put(i, new javax.swing.JLabel("" + i / 100F));
		}
		htDFendas.put(new Integer(10), new javax.swing.JLabel("0.10"));
		jSliderDFendas.setLabelTable(htDFendas);

		final java.util.Hashtable<Integer, JLabel> htDPlanos = new java.util.Hashtable<Integer, JLabel>(10);
		for (int i = 0; i < 601; i += 100) {
			htDPlanos.put(i, new javax.swing.JLabel("" + i / 100F));
		}
		jSliderDPlanos.setLabelTable(htDPlanos);

		jPanelWave.add(YoungInterfCustomizer.wave);
	}

	public static void main(final String args[]) {

		ReCResourceBundle.loadResourceBundle("younginterf",
				"recresource:///pt/utl/ist/elab/client/vyounginterf/resources/messages");

		SwingUtilities.invokeLater(new Runnable() {

			@Override
			public void run() {
				final javax.swing.JFrame dummy = new javax.swing.JFrame();
				dummy.getContentPane().add(new YoungInterfCustomizer());
				dummy.pack();
				dummy.setVisible(true);
				dummy.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
			}
		});

	}

	/**
	 * Este metodo e responsavel pela inicializacao do wavelenghtChooser e
	 * atribuicao de um metodo que detecta quando e alterado o valor do
	 * comprimento de onda (em nm).
	 */
	private void initWavelenghtChooser() {
		YoungInterfCustomizer.wave = new WavelenghtChooser();
		YoungInterfCustomizer.wave.setPreferredSize(new Dimension(430, 60));
		YoungInterfCustomizer.wave.addChangeListener(new javax.swing.event.ChangeListener() {
			@Override
			public void stateChanged(final javax.swing.event.ChangeEvent evt) {
				waveStateChanged(evt);
			}
		});
	}

	/**
	 * This method is called from within the constructor to initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	private void initComponents() {// GEN-BEGIN:initComponents
		java.awt.GridBagConstraints gridBagConstraints;

		jPanelBtns = new javax.swing.JPanel();
		jPanelOKCnl = new javax.swing.JPanel();
		jButtonOK = new javax.swing.JButton();
		jButtonCancel = new javax.swing.JButton();
		jPanelDfC = new javax.swing.JPanel();
		jButtonDefaultConfig = new javax.swing.JButton();
		jPanelRootControls = new javax.swing.JPanel();
		jPanelSliders = new javax.swing.JPanel();
		jPanelLAD = new javax.swing.JPanel();
		jPanelL = new javax.swing.JPanel();
		jPanelWave = new javax.swing.JPanel();
		jTextFieldWave = new javax.swing.JTextField();
		jPanelAD = new javax.swing.JPanel();
		jPanelA = new javax.swing.JPanel();
		jSliderDFendas = new javax.swing.JSlider();
		jTextFieldDFendas = new javax.swing.JTextField();
		jPanelD = new javax.swing.JPanel();
		jSliderDPlanos = new javax.swing.JSlider();
		jTextFieldDPlanos = new javax.swing.JTextField();
		jPanelArea = new javax.swing.JPanel();
		jSliderArea = new javax.swing.JSlider();
		jTextFieldArea = new javax.swing.JTextField();

		setLayout(new java.awt.BorderLayout());

		jPanelBtns.setLayout(new java.awt.GridBagLayout());

		jButtonOK.setText(ReCResourceBundle.findStringOrDefault("younginterf$rec.exp.customizer.title.ok", "OK"));
		jButtonOK.addActionListener(new java.awt.event.ActionListener() {
			@Override
			public void actionPerformed(final java.awt.event.ActionEvent evt) {
				jButtonOKActionPerformed(evt);
			}
		});

		jPanelOKCnl.add(jButtonOK);

		jButtonCancel.setText(ReCResourceBundle.findStringOrDefault("younginterf$rec.exp.customizer.title.cancel",
				"Cancel"));
		jButtonCancel.addActionListener(new java.awt.event.ActionListener() {
			@Override
			public void actionPerformed(final java.awt.event.ActionEvent evt) {
				jButtonCancelActionPerformed(evt);
			}
		});

		jPanelOKCnl.add(jButtonCancel);

		gridBagConstraints = new java.awt.GridBagConstraints();
		gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
		gridBagConstraints.weightx = 1.0;
		jPanelBtns.add(jPanelOKCnl, gridBagConstraints);

		jButtonDefaultConfig.setText(ReCResourceBundle.findStringOrDefault("younginterf$rec.exp.customizer.title.dfc",
				"Default config"));
		jButtonDefaultConfig.addActionListener(new java.awt.event.ActionListener() {
			@Override
			public void actionPerformed(final java.awt.event.ActionEvent evt) {
				jButtonDefaultConfigActionPerformed(evt);
			}
		});

		jPanelDfC.add(jButtonDefaultConfig);

		gridBagConstraints = new java.awt.GridBagConstraints();
		gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
		jPanelBtns.add(jPanelDfC, gridBagConstraints);

		add(jPanelBtns, java.awt.BorderLayout.SOUTH);

		jPanelRootControls.setLayout(new javax.swing.BoxLayout(jPanelRootControls, javax.swing.BoxLayout.Y_AXIS));

		jPanelSliders.setLayout(new javax.swing.BoxLayout(jPanelSliders, javax.swing.BoxLayout.X_AXIS));

		jPanelLAD.setLayout(new javax.swing.BoxLayout(jPanelLAD, javax.swing.BoxLayout.Y_AXIS));

		jPanelL.setBorder(new javax.swing.border.TitledBorder(ReCResourceBundle.findStringOrDefault(
				"younginterf$rec.exp.customizer.title.1", "Wavelenght (\u03BB nm)")));
		jPanelWave.setLayout(new java.awt.BorderLayout());

		jPanelL.add(jPanelWave);

		jTextFieldWave.setColumns(4);
		jTextFieldWave.setHorizontalAlignment(SwingConstants.CENTER);
		jTextFieldWave.setText("580");
		jTextFieldWave.addFocusListener(new java.awt.event.FocusAdapter() {
			@Override
			public void focusLost(final java.awt.event.FocusEvent evt) {
				jTextFieldWaveFocusLost(evt);
			}
		});

		jPanelL.add(jTextFieldWave);

		jPanelLAD.add(jPanelL);

		jPanelAD.setLayout(new javax.swing.BoxLayout(jPanelAD, javax.swing.BoxLayout.X_AXIS));

		jPanelA.setBorder(new javax.swing.border.TitledBorder(ReCResourceBundle.findStringOrDefault(
				"younginterf$rec.exp.customizer.title.2", "Distance between slits (mm)")));
		jSliderDFendas.setPaintLabels(true);
		jSliderDFendas.setPaintTicks(true);
		jSliderDFendas.setMinorTickSpacing(50);
		jSliderDFendas.setMajorTickSpacing(100);
		jSliderDFendas.setValue(200);
		jSliderDFendas.setMinimum(10);
		jSliderDFendas.setMaximum(600);
		jSliderDFendas.addChangeListener(new javax.swing.event.ChangeListener() {
			@Override
			public void stateChanged(final javax.swing.event.ChangeEvent evt) {
				jSliderDFendasStateChanged(evt);
			}
		});

		jPanelA.add(jSliderDFendas);

		jTextFieldDFendas.setColumns(4);
		jTextFieldDFendas.setHorizontalAlignment(SwingConstants.CENTER);
		jTextFieldDFendas.setText("2.0");
		jTextFieldDFendas.addFocusListener(new java.awt.event.FocusAdapter() {
			@Override
			public void focusLost(final java.awt.event.FocusEvent evt) {
				jTextFieldDFendasFocusLost(evt);
			}
		});

		jPanelA.add(jTextFieldDFendas);

		jPanelAD.add(jPanelA);

		jPanelD.setBorder(new javax.swing.border.TitledBorder(ReCResourceBundle.findStringOrDefault(
				"younginterf$rec.exp.customizer.title.3", "Distance between planes (m)")));
		jSliderDPlanos.setPaintLabels(true);
		jSliderDPlanos.setPaintTicks(true);
		jSliderDPlanos.setMinorTickSpacing(50);
		jSliderDPlanos.setMajorTickSpacing(100);
		jSliderDPlanos.setValue(400);
		jSliderDPlanos.setMinimum(100);
		jSliderDPlanos.setMaximum(600);
		jSliderDPlanos.addChangeListener(new javax.swing.event.ChangeListener() {
			@Override
			public void stateChanged(final javax.swing.event.ChangeEvent evt) {
				jSliderDPlanosStateChanged(evt);
			}
		});

		jPanelD.add(jSliderDPlanos);

		jTextFieldDPlanos.setColumns(4);
		jTextFieldDPlanos.setHorizontalAlignment(SwingConstants.CENTER);
		jTextFieldDPlanos.setText("4.00");
		jTextFieldDPlanos.addFocusListener(new java.awt.event.FocusAdapter() {
			@Override
			public void focusLost(final java.awt.event.FocusEvent evt) {
				jTextFieldDPlanosFocusLost(evt);
			}
		});

		jPanelD.add(jTextFieldDPlanos);

		jPanelAD.add(jPanelD);

		jPanelLAD.add(jPanelAD);

		jPanelSliders.add(jPanelLAD);

		jPanelArea.setBorder(new javax.swing.border.TitledBorder(ReCResourceBundle.findStringOrDefault(
				"younginterf$rec.exp.customizer.title.5", "Projection area width (mm)")));
		jPanelArea.setVerifyInputWhenFocusTarget(false);
		jSliderArea.setPaintLabels(true);
		jSliderArea.setOrientation(SwingConstants.VERTICAL);
		jSliderArea.setPaintTicks(true);
		jSliderArea.setMinorTickSpacing(1);
		jSliderArea.setMajorTickSpacing(2);
		jSliderArea.setValue(6);
		jSliderArea.setMinimum(1);
		jSliderArea.setMaximum(20);
		jSliderArea.setSnapToTicks(true);
		jSliderArea.addChangeListener(new javax.swing.event.ChangeListener() {
			@Override
			public void stateChanged(final javax.swing.event.ChangeEvent evt) {
				jSliderAreaStateChanged(evt);
			}
		});

		jPanelArea.add(jSliderArea);

		jTextFieldArea.setColumns(4);
		jTextFieldArea.setHorizontalAlignment(SwingConstants.CENTER);
		jTextFieldArea.setText("6.00");
		jTextFieldArea.addFocusListener(new java.awt.event.FocusAdapter() {
			@Override
			public void focusLost(final java.awt.event.FocusEvent evt) {
				jTextFieldAreaFocusLost(evt);
			}
		});

		jPanelArea.add(jTextFieldArea);

		jPanelSliders.add(jPanelArea);

		jPanelRootControls.add(jPanelSliders);

		add(jPanelRootControls, java.awt.BorderLayout.CENTER);

	}// GEN-END:initComponents

	private void jSliderAreaStateChanged(final javax.swing.event.ChangeEvent evt) {// GEN-FIRST:event_jSliderAreaStateChanged
		jTextFieldArea.setText("" + jSliderArea.getValue());
	}// GEN-LAST:event_jSliderAreaStateChanged

	private void jTextFieldAreaFocusLost(final java.awt.event.FocusEvent evt) {// GEN-FIRST:event_jTextFieldAreaFocusLost
		adjustSlider2(jSliderArea, jTextFieldArea);
	}// GEN-LAST:event_jTextFieldAreaFocusLost

	private void jTextFieldDPlanosFocusLost(final java.awt.event.FocusEvent evt) {// GEN-FIRST:event_jTextFieldDPlanosFocusLost
		adjustSlider3(jSliderDPlanos, jTextFieldDPlanos);
	}// GEN-LAST:event_jTextFieldDPlanosFocusLost

	private void jTextFieldDFendasFocusLost(final java.awt.event.FocusEvent evt) {// GEN-FIRST:event_jTextFieldDFendasFocusLost
		adjustSlider3(jSliderDFendas, jTextFieldDFendas);
	}// GEN-LAST:event_jTextFieldDFendasFocusLost

	private void jTextFieldWaveFocusLost(final java.awt.event.FocusEvent evt) {// GEN-FIRST:event_jTextFieldWaveFocusLost
		adjustSlider(YoungInterfCustomizer.wave, jTextFieldWave);
	}// GEN-LAST:event_jTextFieldWaveFocusLost

	private void jSliderDPlanosStateChanged(final javax.swing.event.ChangeEvent evt) {// GEN-FIRST:event_jSliderDPlanosStateChanged
		jTextFieldDPlanos.setText("" + jSliderDPlanos.getValue() / 100f);
	}// GEN-LAST:event_jSliderDPlanosStateChanged

	private void jSliderDFendasStateChanged(final javax.swing.event.ChangeEvent evt) {// GEN-FIRST:event_jSliderDFendasStateChanged
		jTextFieldDFendas.setText("" + jSliderDFendas.getValue() / 100f);
	}// GEN-LAST:event_jSliderDFendasStateChanged

	private void jButtonDefaultConfigActionPerformed(final java.awt.event.ActionEvent evt) {// GEN-FIRST:event_jButtonDefaultConfigActionPerformed
		jSliderArea.setValue(6);
		jSliderDFendas.setValue(200);
		jSliderDPlanos.setValue(400);
		YoungInterfCustomizer.wave.setValue(580);
	}// GEN-LAST:event_jButtonDefaultConfigActionPerformed

	private void jButtonCancelActionPerformed(final java.awt.event.ActionEvent evt) {// GEN-FIRST:event_jButtonCancelActionPerformed
		fireICustomizerListenerCanceled();
	}// GEN-LAST:event_jButtonCancelActionPerformed

	private void jButtonOKActionPerformed(final java.awt.event.ActionEvent evt) {// GEN-FIRST:event_jButtonOKActionPerformed
		getAcquisitionConfig().setTotalSamples(1082);

		// acqConfig.setSelectedFrequency(new
		// Frequency((double)jSliderTBS.getValue(),hardwareInfo.getHardwareFrequencies(0).getMinimumFrequency().getMultiplier(),hardwareInfo.getHardwareFrequencies(0).getMinimumFrequency().getFrequencyDefType()));

		getAcquisitionConfig().getSelectedHardwareParameter("lambda").setParameterValue("" + YoungInterfCustomizer.wave.getValue());
		getAcquisitionConfig().getSelectedHardwareParameter("dfendas").setParameterValue("" + jSliderDFendas.getValue() / 100F);
		getAcquisitionConfig().getSelectedHardwareParameter("dplanos").setParameterValue("" + jSliderDPlanos.getValue() / 100F);
		getAcquisitionConfig().getSelectedHardwareParameter("lpadrao").setParameterValue("" + jSliderArea.getValue());
		fireICustomizerListenerDone();
	}// GEN-LAST:event_jButtonOKActionPerformed

	public void waveStateChanged(final javax.swing.event.ChangeEvent evt) {
		jTextFieldWave.setText("" + YoungInterfCustomizer.wave.getValue());
	}

	// Metodos que verificam a validade do que foi introduzido na text field
	private void adjustSlider(final WavelenghtChooser waveLC, final javax.swing.JTextField field) {
		int num = 0;
		try {
			num = Integer.parseInt(field.getText().trim());
		} catch (final NumberFormatException nfe) {
			field.setText("" + waveLC.getValue());
		}
		if (num > waveLC.getMaximum() || num < waveLC.getMinimum()) {
			field.setText("" + waveLC.getValue());
		} else {
			waveLC.setValue(num);
		}
	}

	private void adjustSlider2(final javax.swing.JSlider slider, final javax.swing.JTextField field) {
		int num = 0;
		try {
			num = (int) (Float.parseFloat(field.getText().trim()));
		} catch (final NumberFormatException nfe) {
			field.setText("" + slider.getValue());
			return;
		}
		if (num > slider.getMaximum() || num < slider.getMinimum()) {
			field.setText("" + slider.getValue());
		} else {
			slider.setValue(num);
		}
	}

	private void adjustSlider3(final javax.swing.JSlider slider, final javax.swing.JTextField field) {
		int num = 0;
		try {
			num = (int) (Float.parseFloat(field.getText().trim()) * 100);
		} catch (final NumberFormatException nfe) {
			field.setText("" + slider.getValue() / 100f);
			return;
		}
		if (num > slider.getMaximum() || num < slider.getMinimum()) {
			field.setText("" + slider.getValue() / 100f);
		} else {
			slider.setValue(num);
		}
	}

	public int getVirtualDimention(final float dimReal, final float dimVirtual, final float aTransf) {
		return roundToInt(dimVirtual * aTransf / dimReal + dimVirtual / 2);
	}

	/**
	 * Arredonda um double para int de acordo com as casas decimais
	 * 
	 * @param number
	 * @return
	 */
	public int roundToInt(final double number) {
		int rounded = 0;
		if (number % (int) number < 0.5) {
			rounded = (int) number;
		} else if (number % (int) number >= 0.5) {
			rounded = (int) number + 1;
		}
		return rounded;
	}

	// /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// ESTE É PARA ALTERAR
	// /////////////////////////////////////////////////////////////////////////////////
	@Override
	public void setHardwareAcquisitionConfig(final HardwareAcquisitionConfig acqConfig) {
		// Aqui são fornecidos parametros do ultimo utilizador que fez a exp, e'
		// bom manter!
		super.setHardwareAcquisitionConfig(acqConfig);
		if (acqConfig != null) {
			final int lambda = (int) (Float.parseFloat(acqConfig.getSelectedHardwareParameterValue("lambda")));
			final int dfendas = (int) (Float.parseFloat(acqConfig.getSelectedHardwareParameterValue("dfendas"))) / 100;
			final int dplanos = (int) (Float.parseFloat(acqConfig.getSelectedHardwareParameterValue("dplanos"))) / 100;
			final int lpadrao = (int) (Float.parseFloat(acqConfig.getSelectedHardwareParameterValue("lpadrao")));

			YoungInterfCustomizer.wave.setValue(lambda);
			jSliderArea.setValue(lpadrao);
			jSliderDFendas.setValue(dfendas);
			jSliderDPlanos.setValue(dplanos);
		}
	}


	@Override
	public javax.swing.ImageIcon getCustomizerIcon() {
		return new javax.swing.ImageIcon(getClass().getResource(
				"/pt/utl/ist/elab/client/vyounginterf/resources/younginterf_iconified.png"));
	}

	// ESTE É PARA ALTERAR
	@Override
	public String getCustomizerTitle() {
		return "Young's Interferences Experiment Configuration Utility";
	}

	// Variables declaration - do not modify//GEN-BEGIN:variables
	private javax.swing.JButton jButtonCancel;
	private javax.swing.JButton jButtonDefaultConfig;
	private javax.swing.JButton jButtonOK;
	private javax.swing.JPanel jPanelA;
	private javax.swing.JPanel jPanelAD;
	private javax.swing.JPanel jPanelArea;
	private javax.swing.JPanel jPanelBtns;
	private javax.swing.JPanel jPanelD;
	private javax.swing.JPanel jPanelDfC;
	private javax.swing.JPanel jPanelL;
	private javax.swing.JPanel jPanelLAD;
	private javax.swing.JPanel jPanelOKCnl;
	private javax.swing.JPanel jPanelRootControls;
	private javax.swing.JPanel jPanelSliders;
	private javax.swing.JPanel jPanelWave;
	private javax.swing.JSlider jSliderArea;
	private javax.swing.JSlider jSliderDFendas;
	private javax.swing.JSlider jSliderDPlanos;
	private javax.swing.JTextField jTextFieldArea;
	private javax.swing.JTextField jTextFieldDFendas;
	private javax.swing.JTextField jTextFieldDPlanos;
	private javax.swing.JTextField jTextFieldWave;
	// End of variables declaration//GEN-END:variables
	private static WavelenghtChooser wave;

} // end YoungInterfCustomizer
